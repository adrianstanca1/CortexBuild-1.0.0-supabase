import{r as e,j as s}from"./react-core-FGHlRSau.js";import{F as t,U as a,M as r,P as l,N as o,ad as d,ae as i,af as c}from"./module-screens-Dy02k3Q1.js";import{P as n}from"./PhotoLightbox-C62kCQiO.js";import"./vendor-BX0gT1qP.js";import"./google-ai-BrP-uSwO.js";import"./developer-tools-B-VjJpHg.js";import"./supabase-DKHGIEFa.js";import"./axios-ei4kQ0Q2.js";import"./icon-pack-tZfEXMDa.js";import"./monaco-Bh77eHRb.js";const m=({itemId:m,project:x,goBack:h,currentUser:g})=>{const[p,u]=e.useState(null),[b,j]=e.useState(!0),[f,y]=e.useState(""),[N,v]=e.useState(!1),[w,C]=e.useState(0);e.useEffect(()=>{(async()=>{j(!0);const e=await d(m);u(e||null),j(!1)})()},[m]);if(b)return s.jsx("div",{className:"text-center p-8",children:"Loading item details..."});if(!p)return s.jsx("div",{className:"text-center p-8 text-red-500",children:"Punch list item not found."});const S=(e=>{switch(e){case"Open":return{text:"text-red-800",bg:"bg-red-100"};case"Ready for Review":return{text:"text-yellow-800",bg:"bg-yellow-100"};case"Closed":return{text:"text-green-800",bg:"bg-green-100"};default:return{text:"text-gray-800",bg:"bg-gray-100"}}})(p.status),k="operative"===g.role,P=!k||k&&"Open"===p.status,R=p.photos.map((e,s)=>({url:e,caption:`${p.title} - Photo ${s+1}`}));return s.jsxs("div",{className:"flex flex-col h-full max-w-4xl mx-auto",children:[s.jsxs("header",{className:"bg-white p-4 flex items-center border-b mb-8",children:[s.jsx("button",{onClick:h,className:"mr-4 p-2 rounded-full hover:bg-gray-100",children:s.jsx(t,{className:"w-6 h-6 text-gray-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900 truncate",title:p.title,children:p.title}),s.jsx("p",{className:"text-sm text-gray-500",children:x.name})]})]}),s.jsxs("main",{className:"flex-grow space-y-6",children:[s.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-100 p-6 grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("h3",{className:"font-bold text-lg text-gray-800 mb-2",children:"Description"}),s.jsx("p",{className:"text-gray-600 whitespace-pre-wrap",children:p.description||"No description provided."})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Status"}),s.jsxs("select",{value:p.status,onChange:async e=>{if(!p)return;const s=e.target.value,t=p,a={...p,status:s};u(a);try{const e=await i(a,g);u(e)}catch(r){alert(r.message),u(t)}},className:`w-full mt-1 p-2 border border-gray-300 rounded-md font-semibold ${S.text} ${S.bg} disabled:opacity-70 disabled:bg-gray-200 disabled:cursor-not-allowed`,disabled:!P,children:[s.jsx("option",{value:"Open",children:"Open"}),s.jsx("option",{value:"Ready for Review",children:"Ready for Review"}),s.jsx("option",{value:"Closed",disabled:k,children:"Closed"})]})]}),s.jsxs("div",{children:[s.jsxs("p",{className:"text-xs font-bold text-gray-500 uppercase mb-1 flex items-center gap-1.5",children:[s.jsx(a,{className:"w-4 h-4"}),"Assignee"]}),s.jsx("p",{className:"text-gray-800 font-semibold",children:p.assignee})]}),s.jsxs("div",{children:[s.jsxs("p",{className:"text-xs font-bold text-gray-500 uppercase mb-1 flex items-center gap-1.5",children:[s.jsx(r,{className:"w-4 h-4"}),"Location"]}),s.jsx("p",{className:"text-gray-800 font-semibold",children:p.location})]})]})]}),p.photos&&p.photos.length>0&&s.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-100 p-6",children:[s.jsxs("h3",{className:"font-bold text-lg text-gray-800 mb-2 flex items-center gap-2",children:[s.jsx(l,{className:"w-5 h-5"}),"Photos"]}),s.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-4",children:p.photos.map((e,t)=>s.jsx("button",{onClick:()=>(e=>{C(e),v(!0)})(t),className:"block group focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-md",children:s.jsx("img",{src:e,alt:`item-photo-${t}`,className:"w-full h-24 object-cover rounded-md group-hover:opacity-80 transition-opacity"})},t))})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-100 p-6",children:[s.jsxs("h3",{className:"font-bold text-lg text-gray-800 mb-4",children:["Comments (",p.comments.length,")"]}),s.jsx("div",{className:"space-y-4",children:p.comments.map(e=>s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-600 flex-shrink-0",children:e.author.charAt(0)}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-baseline gap-2",children:[s.jsx("p",{className:"font-bold text-sm",children:e.author}),s.jsx("p",{className:"text-xs text-gray-500",children:new Date(e.timestamp).toLocaleString()})]}),s.jsx("p",{className:"text-sm text-gray-700 mt-1",children:e.text})]})]},e.id))}),s.jsxs("div",{className:"mt-6 pt-4 border-t",children:[s.jsx("textarea",{rows:3,value:f,onChange:e=>y(e.target.value),placeholder:"Add a comment...",className:"w-full p-2 border border-gray-300 rounded-md"}),s.jsx("div",{className:"text-right mt-2",children:s.jsx("button",{onClick:async()=>{if(!p||!f.trim())return;const e=await c(p.id,f,g);u(s=>s?{...s,comments:[...s.comments,e]}:null),y("")},className:"px-4 py-2 bg-blue-600 text-white font-bold rounded-md hover:bg-blue-700",children:"Post Comment"})})]})]}),p.history&&p.history.length>0&&s.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-100 p-6",children:[s.jsxs("h3",{className:"font-bold text-lg text-gray-800 mb-4 flex items-center gap-2",children:[s.jsx(o,{className:"w-5 h-5 text-gray-500"}),"History"]}),s.jsx("ul",{className:"space-y-4 border-l-2 border-gray-200 ml-2",children:p.history.slice().reverse().map((e,t)=>s.jsxs("li",{className:"relative pl-6",children:[s.jsx("div",{className:"absolute -left-[7px] top-1.5 w-3 h-3 bg-gray-300 rounded-full ring-4 ring-white"}),s.jsx("p",{className:"text-sm text-gray-800 font-medium",children:e.change}),s.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:["by ",e.author," Â· ",new Date(e.timestamp).toLocaleString()]})]},t))})]})]}),N&&s.jsx(n,{photos:R,startIndex:w,onClose:()=>v(!1)})]})};export{m as default};

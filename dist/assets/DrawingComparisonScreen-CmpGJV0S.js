import{r as e,j as s}from"./react-core-FGHlRSau.js";import{F as a,an as r,ao as l}from"./module-screens-Dy02k3Q1.js";import"./vendor-BX0gT1qP.js";import"./google-ai-BrP-uSwO.js";import"./developer-tools-B-VjJpHg.js";import"./supabase-DKHGIEFa.js";import"./axios-ei4kQ0Q2.js";import"./icon-pack-tZfEXMDa.js";import"./monaco-Bh77eHRb.js";const t=({goBack:t,drawingA:n,drawingB:o})=>{const c=e.useRef(null),i=e.useRef(null),d=e.useRef(null),m=e.useRef(null),[x,f]=e.useState(null),[u,h]=e.useState(null),[j,g]=e.useState(1),[p,v]=e.useState(0),[b,N]=e.useState(1),[w,y]=e.useState(!1);e.useEffect(()=>{"undefined"!=typeof pdfjsLib&&(pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.107/pdf.worker.min.js")},[]),e.useEffect(()=>{(async()=>{if("undefined"==typeof pdfjsLib)return;const e=pdfjsLib.getDocument(n.url),s=pdfjsLib.getDocument(o.url),[a,r]=await Promise.all([e.promise,s.promise]);f(a),h(r),v(Math.max(a.numPages,r.numPages))})()},[n,o]);const k=e.useCallback(async(e,s)=>{const a=async(a,r)=>{if(!a)return;const l=Math.min(e,a.numPages),t=await a.getPage(l),n=t.getViewport({scale:s}),o=r.current;if(o){o.height=n.height,o.width=n.width;const e={canvasContext:o.getContext("2d"),viewport:n};await t.render(e).promise}};await Promise.all([a(x,c),a(u,i)])},[x,u]);return e.useEffect(()=>{x&&u&&k(j,b)},[j,b,x,u,k]),e.useEffect(()=>{const e=(e,s)=>a=>{const r=e.current,l=s.current;r&&l&&(l.scrollTop=r.scrollTop,l.scrollLeft=r.scrollLeft)},s=d.current,a=m.current,r=e(d,m),l=e(m,d);return s?.addEventListener("scroll",r),a?.addEventListener("scroll",l),()=>{s?.removeEventListener("scroll",r),a?.removeEventListener("scroll",l)}},[]),s.jsxs("div",{className:"flex flex-col h-[calc(100vh-4rem)] bg-slate-200",children:[s.jsxs("header",{className:"bg-white p-2 flex justify-between items-center z-10 border-b shadow-sm flex-shrink-0",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("button",{onClick:t,className:"mr-2 p-2 rounded-full hover:bg-gray-100",children:s.jsx(a,{className:"w-6 h-6 text-gray-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"Compare Drawings"}),s.jsxs("p",{className:"text-xs text-gray-500",children:[n.drawingNumber," - ",n.title]})]})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>N(e=>Math.max(.2,e-.2)),className:"p-2 rounded-full hover:bg-gray-100",children:s.jsx(r,{className:"w-5 h-5"})}),s.jsxs("span",{className:"text-sm font-semibold w-12 text-center",children:[(100*b).toFixed(0),"%"]}),s.jsx("button",{onClick:()=>N(e=>Math.min(3,e+.2)),className:"p-2 rounded-full hover:bg-gray-100",children:s.jsx(l,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>g(e=>Math.max(1,e-1)),disabled:j<=1,className:"p-2 rounded-full hover:bg-gray-100 disabled:opacity-50",children:"Prev"}),s.jsxs("span",{className:"text-sm",children:["Page ",j," / ",p]}),s.jsx("button",{onClick:()=>g(e=>Math.min(p,e+1)),disabled:j>=p,className:"p-2 rounded-full hover:bg-gray-100 disabled:opacity-50",children:"Next"})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("label",{htmlFor:"overlay-toggle",className:"mr-2 text-sm font-medium text-gray-700",children:"Overlay"}),s.jsx("input",{type:"checkbox",id:"overlay-toggle",checked:w,onChange:()=>y(!w),className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"})]})]})]}),s.jsx("main",{className:"flex-grow flex flex-row overflow-hidden",children:w?s.jsxs("div",{className:"relative w-full h-full",children:[s.jsx("div",{ref:d,className:"absolute inset-0 overflow-auto",children:s.jsx("canvas",{ref:c})}),s.jsx("div",{ref:m,className:"absolute inset-0 overflow-auto opacity-50",children:s.jsx("canvas",{ref:i,style:{filter:"hue-rotate(180deg) saturate(2)"}})})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"w-1/2 border-r-2 border-gray-300 flex flex-col",children:[s.jsxs("div",{className:"p-2 bg-gray-100 text-center font-bold",children:["Revision ",n.revision," ",s.jsxs("span",{className:"font-normal text-gray-600",children:["(",n.date,")"]})]}),s.jsx("div",{ref:d,className:"flex-grow overflow-auto p-4",children:s.jsx("canvas",{ref:c})})]}),s.jsxs("div",{className:"w-1/2 flex flex-col",children:[s.jsxs("div",{className:"p-2 bg-gray-100 text-center font-bold",children:["Revision ",o.revision," ",s.jsxs("span",{className:"font-normal text-gray-600",children:["(",o.date,")"]})]}),s.jsx("div",{ref:m,className:"flex-grow overflow-auto p-4",children:s.jsx("canvas",{ref:i})})]})]})})]})};export{t as default};

import{r as e,j as t}from"./react-core-FGHlRSau.js";import{F as s,A as a,z as r,U as l,E as n,P as o,K as i,a3 as d,a4 as c}from"./module-screens-Dy02k3Q1.js";import"./vendor-BX0gT1qP.js";import"./google-ai-BrP-uSwO.js";import"./developer-tools-B-VjJpHg.js";import"./supabase-DKHGIEFa.js";import"./axios-ei4kQ0Q2.js";import"./icon-pack-tZfEXMDa.js";import"./monaco-Bh77eHRb.js";const u=({project:u,goBack:m,currentUser:x})=>{const[p,g]=e.useState(""),[h,b]=e.useState(""),[j,f]=e.useState(""),[y,N]=e.useState(""),[v,w]=e.useState([]),[D,S]=e.useState(!1),A=e.useRef(null),[k,C]=e.useState(!1),[P,F]=e.useState(null),[q,R]=e.useState(null),I=["Architect Team","Structural Engineer","MEP Consultant","General Contractor"],T=e=>{e&&w(t=>[...t,...Array.from(e)])};return t.jsxs("div",{className:"flex flex-col h-full max-w-2xl mx-auto",children:[t.jsxs("header",{className:"bg-white p-4 flex items-center border-b mb-8",children:[t.jsx("button",{onClick:m,className:"mr-4 p-2 rounded-full hover:bg-gray-100",children:t.jsx(s,{className:"w-6 h-6 text-gray-600"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"New RFI"}),t.jsx("p",{className:"text-sm text-gray-500",children:u.name})]})]}),t.jsxs("form",{id:"rfi-form",onSubmit:async e=>{if(e.preventDefault(),!(p&&h&&j&&y))return void alert("Please fill in all required fields.");const t=await Promise.all(v.map(e=>new Promise((t,s)=>{const a=new FileReader;a.onload=s=>{t({name:e.name,url:s.target?.result})},a.onerror=s,a.readAsDataURL(e)}))),s={projectId:u.id,subject:p,question:h,status:"Open",assignee:j,dueDate:y,attachments:t};await d(s,x),alert("RFI created successfully!"),m()},className:"flex-grow space-y-6",children:[t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"subject",className:"block text-sm font-bold text-gray-700 mb-1",children:["Subject ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{type:"text",id:"subject",value:p,onChange:e=>g(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md shadow-sm",required:!0})]}),t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"question",className:"block text-sm font-bold text-gray-700 mb-1",children:["Question ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("textarea",{id:"question",rows:6,value:h,onChange:e=>b(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md shadow-sm",required:!0})]}),t.jsxs("div",{className:"mt-2",children:[t.jsxs("button",{type:"button",onClick:async()=>{if(R(null),p.trim()||h.trim()){C(!0),F(null);try{const e=await c(p,h,I);e?F(e):R("AI could not generate suggestions for this RFI.")}catch(e){R("Could not get suggestions at this time.")}finally{C(!1)}}else R("Please enter a subject or question to get suggestions.")},disabled:k||!p.trim()&&!h.trim(),className:"w-full flex items-center justify-center gap-2 px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[k?t.jsx(a,{className:"w-5 h-5 animate-spin"}):t.jsx(r,{className:"w-5 h-5"}),"Get AI Suggestions"]}),q&&t.jsx("p",{className:"text-xs text-center text-red-600 mt-2",children:q})]}),P&&!k&&t.jsxs("div",{className:"mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg text-center transition-opacity duration-500",children:[t.jsxs("h4",{className:"font-bold text-purple-800 flex items-center justify-center gap-2",children:[t.jsx(r,{className:"w-5 h-5"}),"AI Suggestions Ready!"]}),t.jsx("p",{className:"text-sm text-purple-700 mt-1 mb-3",children:"Apply all suggestions with one click, or apply them individually below."}),t.jsx("button",{type:"button",onClick:()=>{P&&(P.suggestedAssignee&&f(P.suggestedAssignee),P.suggestedDueDate&&N(P.suggestedDueDate))},className:"w-full flex items-center justify-center gap-2 px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700",children:"Apply All Suggestions"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"assignee",className:"block text-sm font-bold text-gray-700 mb-1",children:["Assigned To ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{id:"assignee",value:j,onChange:e=>f(e.target.value),className:"w-full p-2 pl-10 border border-gray-300 rounded-md shadow-sm appearance-none",required:!0,children:[t.jsx("option",{value:"",disabled:!0,children:"Select a team or person"}),I.map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsx(l,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"})]}),P?.suggestedAssignee&&t.jsxs("button",{type:"button",onClick:()=>f(P.suggestedAssignee),className:"text-xs text-purple-600 hover:text-purple-800 font-semibold mt-1.5 flex items-center gap-1",children:[t.jsx(r,{className:"w-3.5 h-3.5"}),"Apply Suggestion: ",P.suggestedAssignee]})]}),t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"dueDate",className:"block text-sm font-bold text-gray-700 mb-1",children:["Response Due ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"date",id:"dueDate",value:y,onChange:e=>N(e.target.value),className:"w-full p-2 pl-10 border border-gray-300 rounded-md shadow-sm",required:!0}),t.jsx(n,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"})]}),P?.suggestedDueDate&&t.jsxs("button",{type:"button",onClick:()=>N(P.suggestedDueDate),className:"text-xs text-purple-600 hover:text-purple-800 font-semibold mt-1.5 flex items-center gap-1",children:[t.jsx(r,{className:"w-3.5 h-3.5"}),"Apply Suggestion: ",new Date(P.suggestedDueDate+"T00:00:00").toLocaleDateString()]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Attachments"}),t.jsx("div",{onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),S(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),S(!1)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{e.preventDefault(),e.stopPropagation(),S(!1),e.dataTransfer.files&&e.dataTransfer.files.length>0&&T(e.dataTransfer.files)},onClick:()=>A.current?.click(),className:"mt-2 flex justify-center rounded-lg border border-dashed px-6 py-10 transition-colors cursor-pointer "+(D?"border-blue-600 bg-blue-50":"border-gray-900/25 hover:border-blue-500"),children:t.jsxs("div",{className:"text-center",children:[t.jsx(o,{className:"mx-auto h-12 w-12 text-gray-300","aria-hidden":"true"}),t.jsx("div",{className:"mt-4 flex text-sm leading-6 text-gray-600",children:t.jsxs("p",{className:"pl-1",children:[t.jsx("span",{className:"font-semibold text-blue-600",children:"Click to upload"})," or drag and drop"]})}),t.jsx("p",{className:"text-xs leading-5 text-gray-600",children:"PDF, PNG, JPG up to 10MB"})]})}),v.length>0&&t.jsx("div",{className:"mt-4 space-y-2",children:v.map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-100 rounded-md text-sm",children:[t.jsx("span",{className:"font-medium text-gray-700 truncate",children:e.name}),t.jsx("button",{type:"button",onClick:()=>{return e=s,void w(t=>t.filter((t,s)=>s!==e));var e},className:"p-1 text-gray-400 hover:text-red-500",children:t.jsx(i,{className:"w-4 h-4"})})]},s))}),t.jsx("input",{type:"file",ref:A,onChange:e=>{e.target.files&&T(e.target.files),e.target&&(e.target.value="")},className:"hidden",multiple:!0})]})]}),t.jsxs("footer",{className:"bg-white p-4 mt-8 border-t flex justify-end items-center gap-4",children:[t.jsx("button",{type:"button",onClick:m,className:"px-6 py-3 rounded-md text-gray-700 bg-gray-200 hover:bg-gray-300 font-bold",children:"Cancel"}),t.jsx("button",{type:"submit",form:"rfi-form",className:"px-6 py-3 rounded-md bg-blue-600 text-white hover:bg-blue-700 font-bold",children:"Submit RFI"})]})]})};export{u as default};

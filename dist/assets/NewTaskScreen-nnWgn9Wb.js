import{r as e,j as s}from"./react-core-FGHlRSau.js";import{F as t,z as a,A as r,U as l,E as o,t as i,f as n,K as d,J as c,Y as u,Z as p}from"./module-screens-Dy02k3Q1.js";import"./vendor-BX0gT1qP.js";import"./google-ai-BrP-uSwO.js";import"./developer-tools-B-VjJpHg.js";import"./supabase-DKHGIEFa.js";import"./axios-ei4kQ0Q2.js";import"./icon-pack-tZfEXMDa.js";import"./monaco-Bh77eHRb.js";const g=["Foreman","operative"],m=({project:m,goBack:x,currentUser:h})=>{const[b,f]=e.useState(""),[j,v]=e.useState(""),[y,N]=e.useState(""),[w,D]=e.useState(""),[k,A]=e.useState("Medium"),[S,I]=e.useState([]),C=e.useRef(null),[U,P]=e.useState([]),[R,F]=e.useState(!1),[T,$]=e.useState(null),[q,E]=e.useState(null),[L,M]=e.useState(!1);e.useEffect(()=>{(async()=>{const e=await c(h.companyId);P(e)})()},[h.companyId]);const{suggestedUsers:G,otherUsers:O}=e.useMemo(()=>{const e=new Set(T?.suggestedAssigneeIds||[]);if(0===e.size)return{suggestedUsers:[],otherUsers:U};const s=[],t=[];U.forEach(a=>{e.has(a.id)?s.push(a):t.push(a)});const a=T?.suggestedAssigneeIds||[];return s.sort((e,s)=>a.indexOf(e.id)-a.indexOf(s.id)),{suggestedUsers:s,otherUsers:t}},[U,T]),z=e=>{e&&Array.from(e).forEach(e=>{const s=new FileReader;s.onload=e=>{e.target?.result&&I(s=>[...s,e.target.result])},s.readAsDataURL(e)})};return s.jsxs("div",{className:"flex flex-col h-full max-w-2xl mx-auto",children:[s.jsxs("header",{className:"bg-white p-4 flex items-center border-b mb-8",children:[s.jsx("button",{onClick:x,className:"mr-4 p-2 rounded-full hover:bg-gray-100",children:s.jsx(t,{className:"w-6 h-6 text-gray-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"New Task"}),s.jsx("p",{className:"text-sm text-gray-500",children:m.name})]})]}),s.jsxs("form",{id:"new-task-form",onSubmit:async e=>{if(e.preventDefault(),!b||!y||!w)return void alert("Please fill in all required fields (Title, Assignee/Role, Due Date).");const[s,t]=y.split(":"),a={projectId:m.id,title:b,description:j,status:"To Do",dueDate:w,priority:k,attachments:S.map((e,s)=>({name:`photo_${s+1}.jpg`,url:e}))};if("user"===s)a.assignee=U.find(e=>e.id===t)?.name;else{if("role"!==s)return void alert("Invalid assignee or role.");a.targetRoles=[t]}await u(a,h),alert("Task created successfully!"),x()},className:"flex-grow space-y-6",children:[s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"title",className:"block text-sm font-bold text-gray-700 mb-1",children:["Title ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",id:"title",value:b,onChange:e=>f(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md shadow-sm",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"description",className:"block text-sm font-bold text-gray-700 mb-1",children:"Description"}),s.jsxs("div",{className:"relative",children:[s.jsx("textarea",{id:"description",rows:5,value:j,onChange:e=>v(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md shadow-sm",placeholder:"e.g., 'Install drywall on the 3rd floor, east wing. Use fire-rated board...'"}),T&&s.jsx("div",{title:"AI suggestions are available for this description",className:"absolute top-2 right-2 p-1 bg-purple-100 rounded-full",children:s.jsx(a,{className:"w-5 h-5 text-purple-600"})})]}),s.jsxs("div",{className:"mt-2",children:[s.jsxs("button",{type:"button",onClick:async()=>{if(E(null),j.trim()){F(!0),$(null);try{const e=await p(j,U);e?$(e):E("AI could not generate suggestions for this task.")}catch(e){E("Could not get suggestions at this time.")}finally{F(!1)}}else E("Please enter a description to get suggestions.")},disabled:R||!j.trim(),className:"w-full flex items-center justify-center gap-2 px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[R?s.jsx(r,{className:"w-5 h-5 animate-spin"}):s.jsx(a,{className:"w-5 h-5"}),"Get AI Suggestions"]}),q&&s.jsx("p",{className:"text-xs text-center text-red-600 mt-2",children:q})]}),T&&!R&&s.jsxs("div",{className:"mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg text-center transition-opacity duration-500",children:[s.jsxs("h4",{className:"font-bold text-purple-800 flex items-center justify-center gap-2",children:[s.jsx(a,{className:"w-5 h-5"}),"AI Suggestions Ready!"]}),s.jsx("p",{className:"text-sm text-purple-700 mt-1 mb-3",children:"Apply all suggestions with one click, or apply them individually below."}),s.jsx("button",{type:"button",onClick:()=>{T&&(T.suggestedAssigneeIds&&T.suggestedAssigneeIds.length>0&&N(`user:${T.suggestedAssigneeIds[0]}`),T.suggestedDueDate&&D(T.suggestedDueDate))},className:"w-full flex items-center justify-center gap-2 px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500",children:"Apply All Suggestions"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"assignee",className:"block text-sm font-bold text-gray-700 mb-1",children:["Assignee / Role ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsxs("div",{className:"relative",children:[s.jsxs("select",{id:"assignee",value:y,onChange:e=>N(e.target.value),className:"w-full p-2 pl-10 border border-gray-300 rounded-md shadow-sm appearance-none",required:!0,children:[s.jsx("option",{value:"",disabled:!0,children:"Select assignment"}),s.jsx("optgroup",{label:"Roles",children:g.map(e=>s.jsxs("option",{value:`role:${e}`,children:["All ",e,"s"]},e))}),G.length>0&&s.jsx("optgroup",{label:"âœ¨ Suggested Assignees",children:G.map(e=>s.jsxs("option",{value:`user:${e.id}`,children:[e.name," (",e.role,")"]},e.id))}),s.jsx("optgroup",{label:G.length>0?"Other Users":"Users",children:O.map(e=>s.jsxs("option",{value:`user:${e.id}`,children:[e.name," (",e.role,")"]},e.id))})]}),s.jsx(l,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"})]}),T?.suggestedAssigneeIds&&T.suggestedAssigneeIds.length>0&&s.jsxs("button",{type:"button",onClick:()=>N(`user:${T.suggestedAssigneeIds[0]}`),className:"text-xs text-purple-600 hover:text-purple-800 font-semibold mt-1.5 flex items-center gap-1",children:[s.jsx(a,{className:"w-3.5 h-3.5"}),"Apply Suggestion: ",U.find(e=>e.id===T.suggestedAssigneeIds[0])?.name]})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"dueDate",className:"block text-sm font-bold text-gray-700 mb-1",children:["Due Date ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"date",id:"dueDate",value:w,onChange:e=>D(e.target.value),className:"w-full p-2 pl-10 border border-gray-300 rounded-md shadow-sm",required:!0}),s.jsx(o,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"})]}),T?.suggestedDueDate&&s.jsxs("button",{type:"button",onClick:()=>D(T.suggestedDueDate),className:"text-xs text-purple-600 hover:text-purple-800 font-semibold mt-1.5 flex items-center gap-1",children:[s.jsx(a,{className:"w-3.5 h-3.5"}),"Apply Suggestion: ",new Date(T.suggestedDueDate+"T00:00:00").toLocaleDateString()]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"priority",className:"block text-sm font-bold text-gray-700 mb-1",children:"Priority"}),s.jsxs("div",{className:"relative",children:[s.jsxs("select",{id:"priority",value:k,onChange:e=>A(e.target.value),className:"w-full p-2 pl-10 border border-gray-300 rounded-md shadow-sm appearance-none",required:!0,children:[s.jsx("option",{value:"High",children:"High"}),s.jsx("option",{value:"Medium",children:"Medium"}),s.jsx("option",{value:"Low",children:"Low"})]}),s.jsx(i,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Photos"}),T?.photosRecommended&&s.jsx("div",{className:"mb-2 p-2 bg-purple-50 border-l-4 border-purple-400 text-sm text-purple-800 rounded-r-md",children:s.jsxs("p",{children:[s.jsx(a,{className:"w-4 h-4 inline mr-1"})," AI suggests adding photos for this task."]})}),s.jsx("div",{onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),M(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),M(!1)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{e.preventDefault(),e.stopPropagation(),M(!1);const s=e.dataTransfer.files;s&&s.length>0&&z(s)},onClick:()=>{C.current?.click()},className:`mt-2 flex justify-center rounded-lg border border-dashed px-6 py-10 transition-colors ${L?"border-blue-600 bg-blue-50":"border-gray-900/25 hover:border-blue-500"} cursor-pointer`,children:s.jsxs("div",{className:"text-center",children:[s.jsx(n,{className:"mx-auto h-12 w-12 text-gray-300","aria-hidden":"true"}),s.jsx("div",{className:"mt-4 flex text-sm leading-6 text-gray-600",children:s.jsxs("p",{className:"pl-1",children:[s.jsx("span",{className:"font-semibold text-blue-600",children:"Click to upload"})," or drag and drop"]})}),s.jsx("p",{className:"text-xs leading-5 text-gray-600",children:"PNG, JPG, GIF up to 10MB"})]})}),S.length>0&&s.jsx("div",{className:"mt-4 grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-4",children:S.map((e,t)=>s.jsxs("div",{className:"relative group",children:[s.jsx("img",{src:e,alt:`upload-preview-${t}`,className:"w-full h-28 object-cover rounded-md"}),s.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center rounded-md",children:s.jsx("button",{type:"button",onClick:()=>{return e=t,void I(s=>s.filter((s,t)=>t!==e));var e},className:"text-white rounded-full p-1.5 bg-black/50 hover:bg-red-500 transition-colors","aria-label":"Remove photo",children:s.jsx(d,{className:"h-5 w-5"})})})]},t))}),s.jsx("input",{type:"file",ref:C,onChange:e=>{e.target.files&&z(e.target.files),e.target.value=""},className:"hidden",accept:"image/*",multiple:!0})]})]}),s.jsxs("footer",{className:"bg-white p-4 mt-8 border-t flex justify-end items-center gap-4",children:[s.jsx("button",{type:"button",onClick:x,className:"px-6 py-3 rounded-md text-gray-700 bg-gray-200 hover:bg-gray-300 font-bold",children:"Cancel"}),s.jsx("button",{type:"submit",form:"new-task-form",className:"px-6 py-3 rounded-md bg-blue-600 text-white hover:bg-blue-700 font-bold",children:"Create Task"})]})]})};export{m as default};

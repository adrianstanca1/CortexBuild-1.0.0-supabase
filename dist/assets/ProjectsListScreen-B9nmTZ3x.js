import{r as e,j as s}from"./react-core-FGHlRSau.js";import{M as t,k as r}from"./module-screens-Dy02k3Q1.js";import{s as a}from"./developer-tools-B-VjJpHg.js";import{U as l,X as n,z as i,s as o,H as d}from"./icon-pack-tZfEXMDa.js";import"./vendor-BX0gT1qP.js";import"./google-ai-BrP-uSwO.js";import"./supabase-DKHGIEFa.js";import"./axios-ei4kQ0Q2.js";import"./monaco-Bh77eHRb.js";const c=async(e,s)=>{const t=s.fileName||`${Date.now()}-${e.name}`,r=`${s.folder}/${t}`;if(e.size>104857600)throw new Error("File size exceeds maximum limit of 100MB");if(!["image/jpeg","image/png","image/gif","image/webp","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","text/plain","text/csv"].includes(e.type))throw new Error(`File type ${e.type} is not allowed`);const{data:l,error:n}=await a.storage.from("documents").upload(r,e,{cacheControl:"3600",upsert:!1});if(n)throw n;const{data:i}=a.storage.from("documents").getPublicUrl(l.path);return{path:l.path,url:i.publicUrl,size:e.size,type:e.type}},p=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return Number.parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]},m=({onUploadComplete:t,folder:r,maxSize:a=104857600,accept:m="*/*",multiple:x=!1,className:u=""})=>{const[g,h]=e.useState([]),[f,j]=e.useState(!1),[b,y]=e.useState(!1),v=e.useRef(null),N=e=>{if(!e)return;const s=Array.from(e).map(e=>{const s=e;return s.id=`${Date.now()}-${Math.random()}`,s.progress=0,s.status="pending",e.size>a&&(s.status="error",s.error=`File exceeds maximum size of ${p(a)}`),s});h(e=>x?[...e,...s]:s)},w=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?y(!0):"dragleave"===e.type&&y(!1)},k=e=>{switch(e){case"success":return s.jsx(d,{className:"w-4 h-4 text-green-600"});case"error":return s.jsx(o,{className:"w-4 h-4 text-red-600"});case"uploading":return s.jsx(l,{className:"w-4 h-4 text-blue-600 animate-pulse"});default:return s.jsx(i,{className:"w-4 h-4 text-gray-400"})}},z=e=>{switch(e){case"success":return"border-green-200 bg-green-50";case"error":return"border-red-200 bg-red-50";case"uploading":return"border-blue-200 bg-blue-50";default:return"border-gray-200 bg-gray-50"}};return s.jsxs("div",{className:`file-upload ${u}`,children:[s.jsx("input",{ref:v,type:"file",multiple:x,accept:m,onChange:e=>N(e.target.files),className:"hidden","aria-label":"File upload input"}),s.jsx("div",{className:"border-2 border-dashed rounded-lg p-6 transition-colors "+(b?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-gray-400"),onDragEnter:w,onDragLeave:w,onDragOver:w,onDrop:e=>{e.preventDefault(),e.stopPropagation(),y(!1),e.dataTransfer.files&&e.dataTransfer.files[0]&&N(e.dataTransfer.files)},children:s.jsxs("button",{onClick:()=>v.current?.click(),className:"w-full flex flex-col items-center justify-center gap-2 py-8 hover:bg-gray-50 transition-colors rounded-lg",children:[s.jsx(l,{className:"w-12 h-12 text-gray-400"}),s.jsx("span",{className:"text-gray-600 font-medium",children:b?"Drop files here":"Click to upload files"}),s.jsx("span",{className:"text-sm text-gray-500",children:"or drag and drop"}),s.jsxs("span",{className:"text-xs text-gray-400",children:["Max size: ",p(a)]})]})}),g.length>0&&s.jsx("div",{className:"mt-4 space-y-2",children:g.map(e=>{return s.jsx("div",{className:`flex items-center justify-between p-3 rounded-lg border ${z(e.status)}`,children:s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[s.jsx("span",{className:"text-lg",children:(t=e.type,t.startsWith("image/")?"ðŸ–¼ï¸":t.includes("pdf")?"ðŸ“„":t.includes("word")||t.includes("document")?"ðŸ“":t.includes("excel")||t.includes("spreadsheet")?"ðŸ“Š":t.includes("zip")||t.includes("archive")?"ðŸ“¦":t.includes("text")?"ðŸ“„":"ðŸ“")}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-gray-700 truncate",children:e.name}),s.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[s.jsx("span",{children:p(e.size)}),"uploading"===e.status&&s.jsxs("span",{children:[e.progress,"%"]}),e.error&&s.jsx("span",{className:"text-red-600",children:e.error})]}),"uploading"===e.status&&s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5 mt-1",children:s.jsx("div",{className:"bg-blue-600 h-1.5 rounded-full transition-all",style:{width:`${e.progress}%`}})})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[k(e.status),s.jsx("button",{onClick:()=>{return s=e.id,void h(e=>e.filter(e=>e.id!==s));var s},className:"p-1 hover:bg-gray-200 rounded transition-colors",title:"Remove file",children:s.jsx(n,{className:"w-4 h-4 text-gray-500"})})]})]})},e.id);var t})}),g.length>0&&!f&&s.jsxs("button",{onClick:async()=>{const e=g.filter(e=>"pending"===e.status);if(0===e.length)return;j(!0);const s=[];try{for(const t of e)try{h(e=>e.map(e=>e.id===t.id?{...e,status:"uploading",progress:0}:e));const e=await c(t,{folder:r,onProgress:e=>{h(s=>s.map(s=>s.id===t.id?{...s,progress:e}:s))}});s.push(e),h(e=>e.map(e=>e.id===t.id?{...e,status:"success",progress:100}:e))}catch(a){h(e=>e.map(e=>e.id===t.id?{...e,status:"error",error:a instanceof Error?a.message:"Upload failed"}:e))}s.length>0&&t(s)}finally{j(!1)}},disabled:g.every(e=>"pending"!==e.status),className:"mt-4 w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:["Upload ",g.filter(e=>"pending"===e.status).length," file",1!==g.filter(e=>"pending"===e.status).length?"s":""]}),f&&s.jsx("div",{className:"mt-4 text-center text-gray-600",children:"Uploading files..."})]})},x=({selectProject:a,currentUser:l})=>{const[n,i]=e.useState([]),[o,d]=e.useState(!0),[c,p]=e.useState(!1);e.useEffect(()=>{(async()=>{d(!0);const e=await r(l);i(e),d(!1)})()},[l]);return s.jsxs("div",{className:"w-full",children:[s.jsxs("header",{className:"bg-white p-4 border-b mb-8",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Projects"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Select a project to view its workspace."})]}),s.jsx("button",{onClick:()=>p(!c),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:c?"Hide Upload":"Upload Files"})]}),c&&s.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Upload Project Files"}),s.jsx(m,{onUploadComplete:async e=>{},folder:`company-${l.company_id||"default"}/project-files`,multiple:!0,accept:"*/*"})]})]}),o?s.jsx("p",{className:"text-center text-gray-500",children:"Loading projects..."}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:n.map(e=>s.jsxs("div",{onClick:()=>a(e.id),onKeyDown:s=>{"Enter"!==s.key&&" "!==s.key||a(e.id)},role:"button",tabIndex:0,className:"bg-white rounded-lg shadow-lg overflow-hidden group cursor-pointer transition-all duration-300 hover:shadow-xl hover:-translate-y-1 flex flex-col",children:[s.jsx("div",{className:"h-48 overflow-hidden flex-shrink-0",children:s.jsx("img",{src:e.image,alt:e.name,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"})}),s.jsxs("div",{className:"p-6 flex flex-col flex-grow",children:[s.jsxs("div",{className:"flex-grow",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-800 group-hover:text-blue-600 transition-colors",children:e.name}),s.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1",children:[s.jsx(t,{className:"w-4 h-4 mr-1.5"}),s.jsx("span",{children:e.location})]}),s.jsx("p",{className:"text-gray-600 text-sm mt-4 line-clamp-3",children:e.description})]}),s.jsxs("div",{className:"mt-6 pt-4 border-t flex justify-between text-center",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-bold text-red-600 block text-2xl",children:e.snapshot.openRFIs}),s.jsx("span",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Open RFIs"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-bold text-amber-600 block text-2xl",children:e.snapshot.overdueTasks}),s.jsx("span",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Overdue"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-bold text-orange-600 block text-2xl",children:e.snapshot.pendingTMTickets}),s.jsx("span",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Pending T&M"})]})]})]})]},e.id))})]})};export{x as default};

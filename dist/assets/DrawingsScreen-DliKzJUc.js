import{r as e,j as t}from"./react-core-FGHlRSau.js";import{X as s,z as a,ab as r,F as l,I as i,ah as n,D as d,l as o,ai as c,aj as m}from"./module-screens-Dy02k3Q1.js";import{u as x}from"./index-DOZ8AkwU.js";import"./vendor-BX0gT1qP.js";import"./google-ai-BrP-uSwO.js";import"./developer-tools-B-VjJpHg.js";import"./supabase-DKHGIEFa.js";import"./axios-ei4kQ0Q2.js";import"./icon-pack-tZfEXMDa.js";import"./monaco-Bh77eHRb.js";const u=({project:l,onClose:i,onSubmit:n})=>{const[d,o]=e.useState(""),[c,m]=e.useState(""),[x,u]=e.useState((new Date).toISOString().split("T")[0]),[b,g]=e.useState(null),[h,p]=e.useState(""),j=e=>{const t="101";switch(e){case"arch":o(`A-${t}`),m("Architectural Floor Plan - Level ");break;case"struct":o(`S-${t}`),m("Structural Framing Plan - Level ");break;case"mep":o(`M-${t}`),m("Mechanical Plan - Level ")}};return t.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",onClick:i,children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg",onClick:e=>e.stopPropagation(),children:[t.jsxs("header",{className:"p-4 border-b flex justify-between items-center",children:[t.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Upload New Drawing"}),t.jsx("button",{onClick:i,className:"p-2 rounded-full hover:bg-gray-100",children:t.jsx(s,{className:"w-6 h-6 text-gray-600"})})]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault(),d&&c&&x&&b?(p(""),n({drawingNumber:d,title:c,date:x,file:b})):p("Please fill out all fields and select a file.")},children:[t.jsxs("div",{className:"p-6 space-y-4",children:[h&&t.jsx("p",{className:"text-red-500 text-sm",children:h}),t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-bold text-gray-700 mb-2 flex items-center gap-2",children:[t.jsx(a,{className:"w-4 h-4 text-purple-500"})," Use a Template"]}),t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsx("button",{type:"button",onClick:()=>j("arch"),className:"p-2 text-sm border rounded hover:bg-gray-100",children:"Architectural"}),t.jsx("button",{type:"button",onClick:()=>j("struct"),className:"p-2 text-sm border rounded hover:bg-gray-100",children:"Structural"}),t.jsx("button",{type:"button",onClick:()=>j("mep"),className:"p-2 text-sm border rounded hover:bg-gray-100",children:"MEP"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"dwg-number",className:"block text-sm font-bold text-gray-700 mb-1",children:"Drawing Number"}),t.jsx("input",{type:"text",id:"dwg-number",value:d,onChange:e=>o(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md",required:!0,placeholder:"e.g. A-101"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"If this number exists, a new revision will be created."})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"dwg-title",className:"block text-sm font-bold text-gray-700 mb-1",children:"Drawing Title"}),t.jsx("input",{type:"text",id:"dwg-title",value:c,onChange:e=>m(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md",required:!0})]}),t.jsx("div",{className:"grid grid-cols-2 gap-4",children:t.jsxs("div",{children:[t.jsx("label",{htmlFor:"dwg-date",className:"block text-sm font-bold text-gray-700 mb-1",children:"Date"}),t.jsx("input",{type:"date",id:"dwg-date",value:x,onChange:e=>u(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md",required:!0})]})}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"PDF File"}),t.jsx("div",{className:"mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 px-6 py-10",children:t.jsxs("div",{className:"text-center",children:[t.jsx(r,{className:"mx-auto h-12 w-12 text-gray-300","aria-hidden":"true"}),t.jsxs("div",{className:"mt-4 flex text-sm leading-6 text-gray-600",children:[t.jsxs("label",{htmlFor:"file-upload",className:"relative cursor-pointer rounded-md bg-white font-semibold text-blue-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-blue-600 focus-within:ring-offset-2 hover:text-blue-500",children:[t.jsx("span",{children:"Upload a file"}),t.jsx("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",onChange:e=>{e.target.files&&e.target.files.length>0&&g(e.target.files[0])},accept:".pdf"})]}),t.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),t.jsx("p",{className:"text-xs leading-5 text-gray-600",children:"PDF up to 10MB"}),b&&t.jsx("p",{className:"text-sm text-gray-800 font-semibold mt-2",children:b.name})]})})]})]}),t.jsxs("footer",{className:"p-4 bg-gray-50 border-t flex justify-end items-center gap-3",children:[t.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 bg-gray-200 rounded font-semibold",children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded font-semibold",children:"Upload"})]})]})]})})},b=({project:s,goBack:r,navigateTo:b,currentUser:g})=>{const[h,p]=e.useState([]),[j,f]=e.useState(!0),[N,w]=e.useState(!1),[y,v]=e.useState(""),[C,k]=e.useState([]),[S,F]=e.useState(new Set),[D,P]=e.useState({}),{can:L}=x(g),A=L("create","drawing");e.useEffect(()=>{(async()=>{f(!0);const e=await c();p(e.filter(e=>e.projectId===s.id)),f(!1)})()},[s.id]);const M=e.useMemo(()=>{const e=new Set;return h.forEach(t=>t.tags.forEach(t=>e.add(t))),Array.from(e).sort()},[h]),$=e.useMemo(()=>{const e={};return h.forEach(t=>{e[t.drawingNumber]||(e[t.drawingNumber]=[]),e[t.drawingNumber].push(t)}),Object.values(e).map(e=>{const t=[...e].sort((e,t)=>t.revision-e.revision);return{drawingNumber:t[0].drawingNumber,title:t[0].title,latest:t[0],history:t}}).sort((e,t)=>e.drawingNumber.localeCompare(t.drawingNumber))},[h]),E=e.useMemo(()=>$.filter(e=>{const t=y.toLowerCase(),s=e.drawingNumber.toLowerCase().includes(t)||e.title.toLowerCase().includes(t),a=0===C.length||C.every(t=>e.latest.tags.includes(t));return s&&a}),[$,y,C]);return t.jsxs("div",{className:"flex flex-col h-full max-w-5xl mx-auto",children:[t.jsxs("header",{className:"bg-white p-4 flex justify-between items-center border-b mb-8",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("button",{onClick:r,className:"mr-4 p-2 rounded-full hover:bg-gray-100",children:t.jsx(l,{className:"w-6 h-6 text-gray-600"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Drawings"}),t.jsx("p",{className:"text-sm text-gray-500",children:s.name})]})]}),A&&t.jsx("button",{onClick:()=>w(!0),className:"bg-blue-600 text-white p-2.5 rounded-full shadow hover:bg-blue-700",children:t.jsx(i,{className:"w-6 h-6"})})]}),t.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border",children:[t.jsxs("div",{className:"relative mb-4",children:[t.jsx(n,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),t.jsx("input",{type:"text",placeholder:"Search by drawing number or title...",value:y,onChange:e=>v(e.target.value),className:"w-full p-2 pl-10 border border-gray-300 rounded-md"})]}),t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-bold text-gray-700 mb-2 flex items-center gap-2",children:[t.jsx(a,{className:"w-5 h-5 text-purple-500"})," AI Generated Tags"]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:M.map(e=>t.jsx("button",{onClick:()=>(e=>{k(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e),className:"px-3 py-1 text-xs font-semibold rounded-full border transition-colors "+(C.includes(e)?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-600 border-gray-300 hover:border-blue-500"),children:e},e))})]})]}),t.jsx("main",{className:"flex-grow bg-white rounded-lg shadow-md border border-gray-100 overflow-hidden",children:j?t.jsx("p",{className:"text-center text-slate-500 p-8",children:"Loading drawings..."}):t.jsx("ul",{className:"divide-y divide-slate-200",children:E.map(e=>t.jsxs("li",{children:[t.jsxs("div",{onClick:()=>b("plans",{url:e.latest.url,title:`${e.latest.drawingNumber} - ${e.latest.title}`}),className:"p-4 flex items-center justify-between hover:bg-slate-50 cursor-pointer",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(d,{className:"w-8 h-8 text-fuchsia-500 flex-shrink-0"}),t.jsxs("div",{children:[t.jsxs("p",{className:"font-bold text-gray-800",children:[e.drawingNumber," - ",e.title]}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.jsxs("span",{className:"px-2 py-0.5 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:["Latest Rev: ",e.latest.revision]}),t.jsx("div",{className:"flex flex-wrap gap-1",children:e.latest.tags.map(e=>t.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-medium rounded-full bg-gray-200 text-gray-700",children:e},e))})]})]})]}),t.jsx("button",{onClick:t=>{var s;t.stopPropagation(),s=e.drawingNumber,F(e=>{const t=new Set(e);return t.has(s)?t.delete(s):t.add(s),t})},className:"p-2 rounded-full hover:bg-gray-200",children:t.jsx(o,{className:"w-5 h-5 text-gray-500 transition-transform "+(S.has(e.drawingNumber)?"rotate-180":"")})})]}),S.has(e.drawingNumber)&&t.jsxs("div",{className:"pl-16 pr-4 pb-4 bg-slate-50",children:[t.jsx("h4",{className:"text-sm font-bold text-gray-600 mb-2 pt-2",children:"Version History"}),t.jsx("ul",{className:"space-y-2",children:e.history.map(e=>t.jsxs("li",{className:"p-2 rounded-md bg-white border flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:(D[e.drawingNumber]||[]).includes(e.id),onChange:()=>{return t=e.drawingNumber,s=e.id,void P(e=>{const a=e[t]||[];let r;return r=a.includes(s)?a.filter(e=>e!==s):[...a,s].slice(-2),{...e,[t]:r}});var t,s},className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),t.jsxs("span",{className:"font-semibold text-sm",children:["Rev ",e.revision]}),t.jsxs("span",{className:"text-xs text-gray-500",children:["(",e.date,")"]})]}),t.jsx("button",{onClick:()=>b("plans",{url:e.url,title:`${e.drawingNumber} - ${e.title}`}),className:"text-xs font-semibold text-blue-600 hover:underline",children:"View"})]},e.id))}),t.jsx("div",{className:"mt-3 text-right",children:t.jsx("button",{onClick:()=>(e=>{const t=D[e];if(t&&2===t.length){const e=h.find(e=>e.id===t[0]),s=h.find(e=>e.id===t[1]);if(e&&s){const[t,a]=[e,s].sort((e,t)=>e.revision-t.revision);b("drawing-comparison",{drawingA:t,drawingB:a})}}})(e.drawingNumber),disabled:2!==(D[e.drawingNumber]||[]).length,className:"px-3 py-1.5 bg-blue-600 text-white font-bold rounded-md text-sm disabled:bg-gray-400",children:"Compare Selected"})})]})]},e.drawingNumber))})}),N&&t.jsx(u,{project:s,onClose:()=>w(!1),onSubmit:async e=>{try{const t=await m(s.id,e,g);p(e=>[t,...e]),w(!1)}catch(t){alert("Failed to upload drawing. Please try again.")}}})]})};export{b as default};

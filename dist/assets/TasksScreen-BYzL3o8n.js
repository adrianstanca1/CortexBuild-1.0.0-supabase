import{r as e,j as t}from"./react-core-FGHlRSau.js";import{F as s,I as a,l as r,P as l,x as n,J as d,t as i,L as o,y as c,g as m}from"./module-screens-Dy02k3Q1.js";import{u}from"./index-DOZ8AkwU.js";import"./vendor-BX0gT1qP.js";import"./google-ai-BrP-uSwO.js";import"./developer-tools-B-VjJpHg.js";import"./supabase-DKHGIEFa.js";import"./axios-ei4kQ0Q2.js";import"./icon-pack-tZfEXMDa.js";import"./monaco-Bh77eHRb.js";const x=e=>{if("Done"===e.status)return!1;const t=new Date;return t.setHours(0,0,0,0),new Date(e.dueDate)<t},g=e=>{if(e.assignee)return`To: ${e.assignee}`;if(e.targetRoles&&e.targetRoles.length>0){return`To: All ${e.targetRoles[0]}`}return"Unassigned"},h=e=>{switch(e){case"High":return"bg-red-100 text-red-800";case"Medium":return"bg-yellow-100 text-yellow-800";case"Low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},j=({task:e})=>{if(x(e))return t.jsx(i,{className:"w-6 h-6 text-red-500",title:"Overdue"});switch(e.status){case"Done":return t.jsx(m,{className:"w-6 h-6 text-green-500",title:"Done"});case"In Progress":return t.jsx(c,{className:"w-6 h-6 text-blue-500",title:"In Progress"});case"To Do":return t.jsx(o,{className:"w-6 h-6 text-gray-400",title:"To Do"});default:return t.jsx("div",{className:"w-6 h-6"})}},b=({project:i,navigateTo:o,goBack:c,currentUser:m})=>{const[b,p]=e.useState([]),[D,f]=e.useState([]),[y,N]=e.useState(!0),[v,w]=e.useState(!1),[k,S]=e.useState({status:"open",assignee:"all",dueDateStart:"",dueDateEnd:""}),[T,C]=e.useState("dueDate-asc"),{can:F}=u(m),E=F("create","task");e.useEffect(()=>{(async()=>{N(!0);const[e,t]=await Promise.all([n(i.id,m),d(i.companyId)]);p(e),f(t),N(!1)})()},[i.id,m]);const I=e.useMemo(()=>{let e=[...b];if("all"!==k.status&&(e="open"===k.status?e.filter(e=>"Done"!==e.status):e.filter(e=>e.status===k.status)),"all"!==k.assignee&&(e=e.filter(e=>e.assignee===k.assignee)),k.dueDateStart){const t=new Date(k.dueDateStart);t.setHours(0,0,0,0),e=e.filter(e=>new Date(e.dueDate)>=t)}if(k.dueDateEnd){const t=new Date(k.dueDateEnd);t.setHours(23,59,59,999),e=e.filter(e=>new Date(e.dueDate)<=t)}const t=T;return e.sort((e,s)=>{if("dueDate-desc"===t)return new Date(s.dueDate).getTime()-new Date(e.dueDate).getTime();if("status"===t){const t={"To Do":1,"In Progress":2,Done:3};return(t[e.status]??99)-(t[s.status]??99)}return new Date(e.dueDate).getTime()-new Date(s.dueDate).getTime()}),e},[b,k,T]),P=e=>{const{name:t,value:s}=e.target;S(e=>({...e,[t]:s}))};return t.jsxs("div",{className:"flex flex-col h-full max-w-4xl mx-auto",children:[t.jsxs("header",{className:"bg-white p-4 flex justify-between items-center border-b mb-8",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("button",{onClick:c,className:"mr-4 p-2 rounded-full hover:bg-gray-100",children:t.jsx(s,{className:"w-6 h-6 text-gray-600"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"All Tasks"}),t.jsx("p",{className:"text-sm text-gray-500",children:i.name})]})]}),E&&t.jsx("button",{onClick:()=>o("new-task"),className:"bg-blue-600 text-white p-2.5 rounded-full shadow hover:bg-blue-700",children:t.jsx(a,{className:"w-6 h-6"})})]}),t.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("button",{onClick:()=>w(e=>!e),className:"flex items-center gap-2 font-bold text-gray-700",children:["Filters",t.jsx(r,{className:"w-5 h-5 transition-transform "+(v?"rotate-180":"")})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("label",{htmlFor:"sortBy",className:"text-sm font-medium text-gray-600",children:"Sort by:"}),t.jsxs("select",{id:"sortBy",name:"sortBy",value:T,onChange:e=>C(e.target.value),className:"p-2 border border-gray-300 rounded-md text-sm bg-white",children:[t.jsx("option",{value:"dueDate-asc",children:"Due Date (Soonest)"}),t.jsx("option",{value:"dueDate-desc",children:"Due Date (Latest)"}),t.jsx("option",{value:"status",children:"Status"})]})]})]}),v&&t.jsxs("div",{className:"mt-4 pt-4 border-t",children:[t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 items-end",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),t.jsxs("select",{id:"status",name:"status",value:k.status,onChange:P,className:"mt-1 block w-full p-2 border border-gray-300 rounded-md bg-white",children:[t.jsx("option",{value:"all",children:"All Statuses"}),t.jsx("option",{value:"open",children:"Open"}),t.jsx("option",{value:"To Do",children:"To Do"}),t.jsx("option",{value:"In Progress",children:"In Progress"}),t.jsx("option",{value:"Done",children:"Done"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"assignee",className:"block text-sm font-medium text-gray-700",children:"Assignee"}),t.jsxs("select",{id:"assignee",name:"assignee",value:k.assignee,onChange:P,className:"mt-1 block w-full p-2 border border-gray-300 rounded-md bg-white",children:[t.jsx("option",{value:"all",children:"All Assignees"}),D.map(e=>t.jsx("option",{value:e.name,children:e.name},e.id))]})]}),t.jsxs("div",{className:"lg:col-span-2 grid grid-cols-2 gap-2",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"dueDateStart",className:"block text-sm font-medium text-gray-700",children:"Due From"}),t.jsx("input",{type:"date",id:"dueDateStart",name:"dueDateStart",value:k.dueDateStart,onChange:P,className:"mt-1 block w-full p-2 border border-gray-300 rounded-md bg-white"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"dueDateEnd",className:"block text-sm font-medium text-gray-700",children:"Due To"}),t.jsx("input",{type:"date",id:"dueDateEnd",name:"dueDateEnd",value:k.dueDateEnd,onChange:P,className:"mt-1 block w-full p-2 border border-gray-300 rounded-md bg-white"})]})]})]}),t.jsx("div",{className:"mt-4 text-right",children:t.jsx("button",{onClick:()=>{S({status:"open",assignee:"all",dueDateStart:"",dueDateEnd:""}),C("dueDate-asc")},className:"px-4 py-2 bg-gray-200 text-gray-700 font-semibold rounded-md hover:bg-gray-300 text-sm",children:"Reset Filters"})})]})]}),t.jsx("main",{className:"flex-grow bg-white rounded-lg shadow-md border border-gray-100 overflow-hidden",children:y?t.jsx("p",{className:"text-center text-gray-500 p-8",children:"Loading tasks..."}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"p-2 bg-gray-50 border-b text-sm text-gray-600 font-semibold",children:["Showing ",I.length," of ",b.length," tasks."]}),t.jsx("ul",{className:"divide-y divide-gray-200",children:0===I.length?t.jsx("p",{className:"p-4 text-sm text-center text-gray-500",children:"No tasks match the current filters."}):I.map(e=>{const s=x(e);return t.jsxs("li",{onClick:()=>o("task-detail",{taskId:e.id}),className:"p-4 flex items-center justify-between hover:bg-gray-50 cursor-pointer border-l-4 "+(s?"bg-red-100 border-red-500":"border-transparent"),children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(j,{task:e}),t.jsxs("div",{children:[t.jsxs("p",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.title,e.attachments&&e.attachments.length>0&&t.jsx(l,{className:"w-4 h-4 text-gray-400"})]}),t.jsxs("div",{className:"flex items-center gap-3 text-sm mt-1",children:[t.jsx("p",{className:"text-gray-500",children:g(e)}),t.jsx("span",{className:`px-2 py-0.5 text-xs font-semibold rounded-full ${h(e.priority)}`,children:e.priority})]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-sm font-semibold "+(s?"text-red-600":"text-gray-600"),children:new Date(e.dueDate).toLocaleDateString()}),t.jsx("p",{className:"text-xs text-gray-500",children:"Due Date"})]})]},e.id)})})]})})]})};export{b as default};

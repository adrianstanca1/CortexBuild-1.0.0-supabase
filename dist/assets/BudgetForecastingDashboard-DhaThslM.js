import{r as e,j as t}from"./react-core-FGHlRSau.js";import{s}from"./developer-tools-B-VjJpHg.js";import{D as a,i as r,E as l,ac as d,a as c,ba as i,T as x,e as n,b as m}from"./icon-pack-tZfEXMDa.js";import"./vendor-BX0gT1qP.js";import"./supabase-DKHGIEFa.js";import"./axios-ei4kQ0Q2.js";import"./monaco-Bh77eHRb.js";const o=({currentUser:o,goBack:h})=>{const[p,g]=e.useState([]),[j,u]=e.useState("month"),[b,N]=e.useState(!0);e.useEffect(()=>{f()},[j]);const f=async()=>{try{if(!s)return void g([]);const{data:e}=await s.from("budgets").select("total_budget, total_spent, forecast, period, project:projects(name)"),t=(e||[]).map(e=>{const t=Number(e.total_budget||0),s=Number(e.total_spent||0),a=Number(e.forecast||s),r=a-t,l=r>0?"over-budget":(t>0?s/t:0)>.85?"at-risk":"on-track";return{projectName:e.project?.name||"Project",totalBudget:t,spent:s,committed:0,forecasted:a,variance:r,status:l}});g(t)}finally{N(!1)}},y=p.reduce((e,t)=>e+t.totalBudget,0),v=p.reduce((e,t)=>e+t.spent,0),w=p.reduce((e,t)=>e+t.forecasted,0),B=w-y,S=v/y*100,k=e=>{switch(e){case"on-track":return t.jsx(m,{className:"h-5 w-5 text-green-600"});case"at-risk":return t.jsx(n,{className:"h-5 w-5 text-yellow-600"});case"over-budget":return t.jsx(n,{className:"h-5 w-5 text-red-600"})}},F=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(e);return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6",children:t.jsxs("div",{className:"max-w-7xl mx-auto",children:[t.jsx("div",{className:"mb-8",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(a,{className:"h-8 w-8 text-green-600"}),t.jsx("h1",{className:"text-4xl font-bold text-gray-900",children:"Budget Forecasting"})]}),t.jsx("p",{className:"text-gray-600 text-lg",children:"AI-powered financial intelligence and cost optimization"})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:[t.jsx(r,{className:"h-4 w-4"}),"Refresh"]}),t.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[t.jsx(l,{className:"h-4 w-4"}),"Export"]})]})]})}),t.jsx("div",{className:"bg-white rounded-xl p-4 shadow-md border border-gray-200 mb-8",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(d,{className:"h-5 w-5 text-gray-600"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Timeframe:"}),t.jsx("div",{className:"flex gap-2",children:["month","quarter","year"].map(e=>t.jsx("button",{onClick:()=>u(e),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors "+(j===e?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[t.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white shadow-xl",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-blue-100",children:"Total Budget"}),t.jsx(a,{className:"h-6 w-6 text-blue-100"})]}),t.jsx("div",{className:"text-3xl font-bold mb-1",children:F(y)}),t.jsxs("div",{className:"text-sm text-blue-100",children:["Across ",p.length," projects"]})]}),t.jsxs("div",{className:"bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-6 text-white shadow-xl",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-green-100",children:"Total Spent"}),t.jsx(c,{className:"h-6 w-6 text-green-100"})]}),t.jsx("div",{className:"text-3xl font-bold mb-1",children:F(v)}),t.jsxs("div",{className:"text-sm text-green-100",children:[S.toFixed(1),"% utilized"]})]}),t.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-6 text-white shadow-xl",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-purple-100",children:"Forecasted"}),t.jsx(i,{className:"h-6 w-6 text-purple-100"})]}),t.jsx("div",{className:"text-3xl font-bold mb-1",children:F(w)}),t.jsx("div",{className:"text-sm text-purple-100",children:"AI prediction"})]}),t.jsxs("div",{className:`bg-gradient-to-br ${B>=0?"from-red-500 to-red-600":"from-emerald-500 to-emerald-600"} rounded-xl p-6 text-white shadow-xl`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-white/90",children:"Variance"}),B>=0?t.jsx(c,{className:"h-6 w-6"}):t.jsx(x,{className:"h-6 w-6"})]}),t.jsx("div",{className:"text-3xl font-bold mb-1",children:F(Math.abs(B))}),t.jsxs("div",{className:"text-sm text-white/90",children:[B>=0?"Over":"Under"," budget"]})]})]}),t.jsxs("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden",children:[t.jsx("div",{className:"p-6 border-b border-gray-200",children:t.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Project Budget Overview"})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-900",children:"Project"}),t.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-900",children:"Budget"}),t.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-900",children:"Spent"}),t.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-900",children:"Committed"}),t.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-900",children:"Forecasted"}),t.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-900",children:"Variance"}),t.jsx("th",{className:"px-6 py-4 text-center text-sm font-semibold text-gray-900",children:"Status"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:p.map(e=>{e.totalBudget,e.spent,e.committed;const s=e.spent/e.totalBudget*100;return t.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[t.jsxs("td",{className:"px-6 py-4",children:[t.jsx("div",{className:"font-medium text-gray-900",children:e.projectName}),t.jsxs("div",{className:"text-sm text-gray-500",children:[s.toFixed(1),"% spent"]})]}),t.jsx("td",{className:"px-6 py-4 text-right font-medium text-gray-900",children:F(e.totalBudget)}),t.jsx("td",{className:"px-6 py-4 text-right text-green-600 font-medium",children:F(e.spent)}),t.jsx("td",{className:"px-6 py-4 text-right text-yellow-600 font-medium",children:F(e.committed)}),t.jsx("td",{className:"px-6 py-4 text-right text-purple-600 font-medium",children:F(e.forecasted)}),t.jsxs("td",{className:"px-6 py-4 text-right font-semibold "+(e.variance>=0?"text-red-600":"text-green-600"),children:[e.variance>=0?"+":"",F(e.variance)]}),t.jsx("td",{className:"px-6 py-4 text-center",children:t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[k(e.status),t.jsx("span",{className:"text-sm font-medium capitalize text-gray-700",children:e.status.replace("-"," ")})]})})]},e.projectName)})})]})})]})]})})};export{o as BudgetForecastingDashboard};

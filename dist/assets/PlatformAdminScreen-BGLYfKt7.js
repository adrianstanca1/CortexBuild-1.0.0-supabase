import{r as e,j as t}from"./react-core-FGHlRSau.js";import{az as s,aA as a,aB as r,aC as l,aD as n,aE as i,aF as c,aG as d,aH as o,aI as x,aJ as m,aK as u,aL as p}from"./module-screens-Dy02k3Q1.js";import"./vendor-BX0gT1qP.js";import"./google-ai-BrP-uSwO.js";import"./developer-tools-B-VjJpHg.js";import"./supabase-DKHGIEFa.js";import"./axios-ei4kQ0Q2.js";import"./icon-pack-tZfEXMDa.js";import"./monaco-Bh77eHRb.js";const g=()=>`id-${Math.random().toString(36).slice(2,10)}`,h=async()=>{const e=localStorage.getItem("constructai_token")||localStorage.getItem("token")||"",t=await fetch("/api/admin/dashboard",{headers:{"Content-Type":"application/json",...e?{Authorization:`Bearer ${e}`}:{}}});if(!t.ok)throw new Error(`Failed to load platform dashboard (${t.status})`);const s=await t.json();if(s?.error)throw new Error(s.error);return(e=>{const t=e?.totals??{},s=e?.userStats??{},a=e?.companyStats??{},r=e?.projectStats??{},l=e?.sdkStats??{},n=e?.systemStats??{},i=Array.isArray(e?.tenantUsage)?e.tenantUsage:[],c=Array.isArray(e?.recentActivity)?e.recentActivity:[],d=Number(t.companies??a.total??i.length??0),o=Number(t.users??s.total??0),x=Number(t.projects??r.total??0),m=Number(a.active??Math.max(1,i.length)),u=Number(l.costThisMonth??0),p=Math.max(0,Math.round(.35*d)),h=Math.max(0,Math.round(.4*d)),b=Math.max(0,d-p-h),y={active_companies:m,total_companies:d,total_users:o,total_projects:x,total_tasks:24*Number(r.total??0),active_subscriptions:Number(l.developers??i.length??0),monthly_revenue:u},j={new_companies_this_month:Number(a.newThisMonth??0),new_users_this_month:Number(s.newThisWeek??0),new_projects_this_month:Number(r.active??0),mrr:u,arr:12*u,revenue_growth:Number(l.revenueGrowth??12),active_users_today:Number(s.active??0),active_users_this_week:Number(s.active??0),active_users_this_month:Number(s.total??0),free_plan_count:p,professional_plan_count:h,enterprise_plan_count:b,most_popular_agent:l.topProviders?.[0]?.provider??"Not available",total_agent_subscriptions:Number(l.requestsThisMonth??0),agent_revenue:u},f=i.map(e=>{const t=e.projects>=6?"enterprise":e.projects>=3?"professional":"free";return{id:String(e.companyId??e.company_id??g()),name:e.companyName??"Unknown Company",plan:t,user_count:Number(e.users??0),project_count:Number(e.projects??0),task_count:12*Number(e.projects??0),subscription_count:Number(e.users??0),monthly_spend:Number((e.apiCost??0).toFixed(2))}}),v=(l.topProviders??[]).map((e,t)=>({id:String(e.provider??`provider-${t}`),name:e.provider??`Provider ${t+1}`,description:e.provider??"AI Provider",category:"integration",status:"active",icon:"ü§ñ",subscription_count:Number(e.requests??0),monthly_revenue:Number(e.cost??0)})),N={plan_revenue:{free:Number((.1*u).toFixed(2)),professional:Number((.45*u).toFixed(2)),enterprise:Number((.45*u).toFixed(2))},agent_revenue:v.reduce((e,t)=>(e[String(t.id)]=t.monthly_revenue,e),{}),total_revenue:u},w={status:n?.uptime&&n.uptime<95?"degraded":"healthy",database:{status:"connected",response_time_ms:Math.round(n?.cpu??42)},api:{status:"operational",response_time_ms:Math.round(n?.memory??38)},storage:{used_gb:Math.round(n?.storage??512),total_gb:1024,percentage:Math.round((n?.storage??512)/1024*100)},uptime_percentage:Number((n?.uptime??99.9).toFixed(2))},C=["Jan","Feb","Mar","Apr","May","Jun"],k={labels:C,datasets:[{label:"Companies",data:C.map((e,t)=>Math.max(1,Math.round(d*((t+1)/C.length)))),backgroundColor:"rgba(59, 130, 246, 0.5)",borderColor:"rgb(59, 130, 246)"}]},A={labels:C,datasets:[{label:"Revenue ($)",data:C.map((e,t)=>Math.round((u||1e3)*(.6+.15*t))),backgroundColor:"rgba(34, 197, 94, 0.5)",borderColor:"rgb(34, 197, 94)"}]},_={labels:["Free","Professional","Enterprise"],datasets:[{label:"Companies",data:[p,h,b],backgroundColor:["rgba(156, 163, 175, 0.5)","rgba(59, 130, 246, 0.5)","rgba(139, 92, 246, 0.5)"],borderColor:"rgb(59, 130, 246)"}]},S={labels:v.map(e=>e.name),datasets:[{label:"Subscriptions",data:v.map(e=>e.subscription_count),backgroundColor:"rgba(168, 85, 247, 0.5)",borderColor:"rgb(168, 85, 247)"}]};return{stats:y,metrics:j,companies:f,agents:v,recentActivity:c.map(e=>({id:String(e.id??g()),type:e.action??"company_created",title:e.action??"System Event",description:e.description??"No additional details",company_id:e.companyId??e.company_id,company_name:e.companyName??e.company_name,user_id:e.userId??e.user_id,user_name:e.userName??e.user_name,timestamp:e.createdAt??e.created_at??(new Date).toISOString(),icon:"üõ∞Ô∏è",color:"#6366F1"})),revenueBreakdown:N,systemHealth:w,companiesGrowthChart:k,revenueGrowthChart:A,planDistributionChart:_,agentPopularityChart:S}})(s?.data)},b=({currentUser:s,navigateTo:a})=>{const[r,l]=e.useState(null),[n,i]=e.useState(!0),[c,d]=e.useState(null);e.useEffect(()=>{o()},[]);const o=async()=>{try{i(!0),d(null);const e=await h();l(e)}catch(e){d(e.message||"Failed to load dashboard data")}finally{i(!1)}};if(n)return t.jsx("div",{className:"flex items-center justify-center min-h-screen",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Loading Platform Dashboard..."})]})});if(c||!r)return t.jsx("div",{className:"flex items-center justify-center min-h-screen",children:t.jsxs("div",{className:"text-center max-w-md",children:[t.jsx("div",{className:"text-6xl mb-4",children:"‚ö†Ô∏è"}),t.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Error Loading Dashboard"}),t.jsx("p",{className:"text-gray-600 mb-6",children:c||"Unknown error occurred"}),t.jsx("button",{type:"button",onClick:o,className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700",children:"Try Again"})]})});const{stats:x,metrics:m,companies:u,agents:p,recentActivity:g,systemHealth:b}=r;return t.jsxs("div",{className:"space-y-8 pb-8",children:[t.jsx("header",{className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl shadow-lg p-8",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-4xl font-bold mb-2",children:"üöÄ Platform Admin Dashboard"}),t.jsxs("p",{className:"text-blue-100 text-lg",children:["Welcome back, ",s.name,"! Here's your platform overview."]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-sm text-blue-200",children:"System Status"}),t.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[t.jsx("div",{className:"w-3 h-3 rounded-full "+("healthy"===b.status?"bg-green-400":"degraded"===b.status?"bg-yellow-400":"bg-red-400")}),t.jsx("span",{className:"font-semibold capitalize",children:b.status})]})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsx("div",{className:"bg-white rounded-xl shadow-md p-6 border-l-4 border-blue-500",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Companies"}),t.jsx("p",{className:"text-3xl font-bold text-gray-900",children:x.total_companies}),t.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["+",m.new_companies_this_month," this month"]})]}),t.jsx("div",{className:"text-4xl",children:"üè¢"})]})}),t.jsx("div",{className:"bg-white rounded-xl shadow-md p-6 border-l-4 border-green-500",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Users"}),t.jsx("p",{className:"text-3xl font-bold text-gray-900",children:x.total_users}),t.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["+",m.new_users_this_month," this month"]})]}),t.jsx("div",{className:"text-4xl",children:"üë•"})]})}),t.jsx("div",{className:"bg-white rounded-xl shadow-md p-6 border-l-4 border-purple-500",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Monthly Revenue"}),t.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:["$",m.mrr.toLocaleString()]}),t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["ARR: $",m.arr.toLocaleString()]})]}),t.jsx("div",{className:"text-4xl",children:"üí∞"})]})}),t.jsx("div",{className:"bg-white rounded-xl shadow-md p-6 border-l-4 border-orange-500",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Active Subscriptions"}),t.jsx("p",{className:"text-3xl font-bold text-gray-900",children:x.active_subscriptions}),t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Across ",x.active_companies," companies"]})]}),t.jsx("div",{className:"text-4xl",children:"‚úÖ"})]})})]}),t.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Plan Distribution"}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[t.jsx("div",{className:"text-3xl font-bold text-gray-600",children:m.free_plan_count}),t.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Free"})]}),t.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[t.jsx("div",{className:"text-3xl font-bold text-blue-600",children:m.professional_plan_count}),t.jsx("div",{className:"text-sm text-blue-600 mt-1",children:"Professional"})]}),t.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[t.jsx("div",{className:"text-3xl font-bold text-purple-600",children:m.enterprise_plan_count}),t.jsx("div",{className:"text-sm text-purple-600 mt-1",children:"Enterprise"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Top Companies"}),t.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:text-blue-700 font-semibold",children:"View All ‚Üí"})]}),t.jsx("div",{className:"space-y-3",children:u.slice(0,5).map(e=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold text-gray-900",children:e.name}),t.jsxs("div",{className:"text-xs text-gray-600",children:[e.user_count," users ‚Ä¢ ",e.project_count," projects"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"inline-block px-2 py-1 rounded text-xs font-semibold "+("enterprise"===e.plan?"bg-purple-100 text-purple-700":"professional"===e.plan?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:e.plan}),t.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["$",e.monthly_spend,"/mo"]})]})]},e.id))})]}),t.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Agent Performance"}),t.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:text-blue-700 font-semibold",children:"Manage ‚Üí"})]}),t.jsx("div",{className:"space-y-3",children:p.map(e=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold text-gray-900",children:e.name}),t.jsx("div",{className:"text-xs text-gray-600",children:e.category})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"font-semibold text-gray-900",children:[e.subscription_count," subs"]}),t.jsxs("div",{className:"text-xs text-green-600",children:["$",e.monthly_revenue,"/mo"]})]})]},e.id))})]})]}),t.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Recent Activity"}),t.jsx("div",{className:"space-y-3",children:g.length>0?g.map(e=>t.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-gray-50 rounded-lg",children:[t.jsx("div",{className:"text-2xl",children:e.icon}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold text-gray-900",children:e.title}),t.jsx("div",{className:"text-sm text-gray-600",children:e.description}),t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:new Date(e.timestamp).toLocaleString()})]})]},e.id)):t.jsx("div",{className:"text-center py-8 text-gray-500",children:"No recent activity"})})]}),t.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"System Health"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Database"}),t.jsx("span",{className:"text-xs px-2 py-1 rounded "+("connected"===b.database.status?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:b.database.status})]}),t.jsxs("div",{className:"text-xs text-gray-600",children:["Response: ",b.database.response_time_ms,"ms"]})]}),t.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"API"}),t.jsx("span",{className:"text-xs px-2 py-1 rounded "+("operational"===b.api.status?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:b.api.status})]}),t.jsxs("div",{className:"text-xs text-gray-600",children:["Response: ",b.api.response_time_ms,"ms"]})]}),t.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Uptime"}),t.jsxs("span",{className:"text-xs px-2 py-1 rounded bg-green-100 text-green-700",children:[b.uptime_percentage,"%"]})]}),t.jsx("div",{className:"text-xs text-gray-600",children:"Last 30 days"})]})]})]})]})},y=({currentUser:l})=>{const[n,i]=e.useState([]),[c,d]=e.useState([]),[o,x]=e.useState(!1),[m,u]=e.useState(null),[p,g]=e.useState(null),[h,b]=e.useState("");e.useEffect(()=>{y()},[]);const y=async()=>{x(!0),u(null);try{const[e,t]=await Promise.all([s(l),a()]);i(e),d(t)}catch(e){u(e.message||"Failed to load data")}finally{x(!1)}};return o?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):m?t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[t.jsx("div",{className:"text-red-800",children:m}),t.jsx("button",{onClick:y,className:"mt-4 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors",children:"Retry"})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Companies Management"}),t.jsxs("div",{className:"text-sm text-gray-600",children:["Total: ",n.length," companies"]})]}),t.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Company"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Plan"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Users"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Projects"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Revenue"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(e=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:t.jsx("span",{className:"text-blue-600 font-bold text-sm",children:e.name.charAt(0).toUpperCase()})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",e.id.slice(0,8),"..."]})]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.plan?t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.plan.name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["$",e.plan.priceMonthly,"/month"]})]}):t.jsx("span",{className:"text-sm text-gray-400",children:"No plan"})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsxs("div",{className:"text-sm text-gray-900",children:[e.userCount,e.plan&&e.plan.maxUsers>0&&t.jsxs("span",{className:"text-gray-500",children:["/",e.plan.maxUsers]})]}),t.jsx("div",{className:"text-xs text-gray-500",children:e.plan&&e.plan.maxUsers>0&&`${Math.round(e.userCount/e.plan.maxUsers*100)}% used`})]}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsxs("div",{className:"text-sm text-gray-900",children:[e.projectCount,e.plan&&e.plan.maxProjects>0&&t.jsxs("span",{className:"text-gray-500",children:["/",e.plan.maxProjects]})]}),t.jsx("div",{className:"text-xs text-gray-500",children:e.plan&&e.plan.maxProjects>0&&`${Math.round(e.projectCount/e.plan.maxProjects*100)}% used`})]}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["$",e.plan?.priceMonthly||0,"/mo"]}),t.jsxs("div",{className:"text-xs text-gray-500",children:["$",(e.plan?.priceYearly||0)/12,"/mo yearly"]})]}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[t.jsx("button",{onClick:()=>g(e.id),className:"text-blue-600 hover:text-blue-900 mr-4",children:"Change Plan"}),t.jsx("button",{className:"text-gray-600 hover:text-gray-900",children:"View Details"})]})]},e.id))})]})}),p&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Change Company Plan"}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select New Plan"}),t.jsxs("select",{value:h,onChange:e=>b(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Select a plan..."}),c.map(e=>t.jsxs("option",{value:e.id,children:[e.name," - $",e.priceMonthly,"/month"]},e.id))]})]}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{onClick:()=>{g(null),b("")},className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),t.jsx("button",{onClick:()=>(async(e,t)=>{try{await r(l,e,t)&&(await y(),g(null),b(""))}catch(s){u(s.message||"Failed to update plan")}})(p,h),disabled:!h,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400",children:"Update Plan"})]})]})})]})},j=({currentUser:s})=>{const[a,r]=e.useState([]),[i,c]=e.useState(!1),[d,o]=e.useState(null),[x,m]=e.useState(!1),[u,p]=e.useState({email:"",companyName:"",invitationType:"company_admin"});e.useEffect(()=>{g()},[]);const g=async()=>{c(!0),o(null);try{const e=await l(s);r(e)}catch(e){o(e.message||"Failed to load invitations")}finally{c(!1)}},h=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"accepted":return"bg-green-100 text-green-800";case"declined":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},b=e=>{switch(e){case"super_admin":return"bg-red-100 text-red-800";case"company_admin":return"bg-blue-100 text-blue-800";case"platform_partner":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}};return i?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Platform Invitations"}),t.jsx("button",{onClick:()=>m(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Send Invitation"})]}),d&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:t.jsx("div",{className:"text-red-800",children:d})}),x&&t.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[t.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-4",children:"Send New Invitation"}),t.jsxs("form",{onSubmit:async e=>{e.preventDefault(),o(null);try{await n(s,u.email,u.companyName,u.invitationType),p({email:"",companyName:"",invitationType:"company_admin"}),m(!1),g()}catch(t){o(t.message||"Failed to send invitation")}},className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),t.jsx("input",{type:"email",value:u.email,onChange:e=>p({...u,email:e.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter email address",title:"Email Address",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name"}),t.jsx("input",{type:"text",value:u.companyName,onChange:e=>p({...u,companyName:e.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter company name",title:"Company Name",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Invitation Type"}),t.jsxs("select",{value:u.invitationType,onChange:e=>p({...u,invitationType:e.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",title:"Invitation Type",children:[t.jsx("option",{value:"company_admin",children:"Company Admin"}),t.jsx("option",{value:"super_admin",children:"Super Admin"}),t.jsx("option",{value:"platform_partner",children:"Platform Partner"})]})]}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{type:"button",onClick:()=>m(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Send Invitation"})]})]})]}),t.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Company"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sent"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Expires"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:0===a.length?t.jsx("tr",{children:t.jsx("td",{colSpan:6,className:"px-6 py-4 text-center text-gray-500",children:'No invitations sent yet. Click "Send Invitation" to get started.'})}):a.map(e=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.email})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900",children:e.companyName})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${b(e.invitationType)}`,children:e.invitationType.replace("_"," ")})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${h(e.status)}`,children:e.status})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.createdAt).toLocaleDateString()}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.expiresAt).toLocaleDateString()})]},e.id))})]})})]})},f=({currentUser:s})=>{const[r,l]=e.useState([]),[n,o]=e.useState(!1),[x,m]=e.useState(null),[u,p]=e.useState(!1),[g,h]=e.useState(null),[b,y]=e.useState({name:"",description:"",priceMonthly:0,priceYearly:0,maxUsers:0,maxProjects:0,features:[],aiAgentsIncluded:[],aiAgentsLimit:0,storageGb:0,isActive:!0,isFeatured:!1,sortOrder:0});e.useEffect(()=>{j()},[]);const j=async()=>{o(!0),m(null);try{const e=await a();l(e)}catch(e){m(e.message||"Failed to load plans")}finally{o(!1)}},f=()=>{y({name:"",description:"",priceMonthly:0,priceYearly:0,maxUsers:0,maxProjects:0,features:[],aiAgentsIncluded:[],aiAgentsLimit:0,storageGb:0,isActive:!0,isFeatured:!1,sortOrder:0}),h(null),p(!1)};return n?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Company Plans Management"}),t.jsx("button",{onClick:()=>p(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Create New Plan"})]}),x&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:t.jsx("div",{className:"text-red-800",children:x})}),u&&t.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[t.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-4",children:g?"Edit Plan":"Create New Plan"}),t.jsxs("form",{onSubmit:g?async e=>{e.preventDefault(),m(null);try{await i(s,g.id,b),f(),j()}catch(t){m(t.message||"Failed to update plan")}}:async e=>{e.preventDefault(),m(null);try{await c(s,b),f(),j()}catch(t){m(t.message||"Failed to create plan")}},className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Plan Name"}),t.jsx("input",{type:"text",value:b.name,onChange:e=>y({...b,name:e.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter plan name",title:"Plan Name",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sort Order"}),t.jsx("input",{type:"number",value:b.sortOrder,onChange:e=>y({...b,sortOrder:parseInt(e.target.value)||0}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0",title:"Sort Order",min:"0"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),t.jsx("textarea",{value:b.description,onChange:e=>y({...b,description:e.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter plan description",title:"Description",rows:3})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Monthly Price ($)"}),t.jsx("input",{type:"number",value:b.priceMonthly,onChange:e=>y({...b,priceMonthly:parseFloat(e.target.value)||0}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00",title:"Monthly Price",min:"0",step:"0.01"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Yearly Price ($)"}),t.jsx("input",{type:"number",value:b.priceYearly,onChange:e=>y({...b,priceYearly:parseFloat(e.target.value)||0}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00",title:"Yearly Price",min:"0",step:"0.01"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Max Users"}),t.jsx("input",{type:"number",value:b.maxUsers,onChange:e=>y({...b,maxUsers:parseInt(e.target.value)||0}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0",title:"Max Users",min:"0"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Max Projects"}),t.jsx("input",{type:"number",value:b.maxProjects,onChange:e=>y({...b,maxProjects:parseInt(e.target.value)||0}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0",title:"Max Projects",min:"0"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Storage (GB)"}),t.jsx("input",{type:"number",value:b.storageGb,onChange:e=>y({...b,storageGb:parseInt(e.target.value)||0}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0",title:"Storage GB",min:"0"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"AI Agents Limit"}),t.jsx("input",{type:"number",value:b.aiAgentsLimit,onChange:e=>y({...b,aiAgentsLimit:parseInt(e.target.value)||0}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0",title:"AI Agents Limit",min:"0"})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("label",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",checked:b.isActive,onChange:e=>y({...b,isActive:e.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),t.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Active"})]}),t.jsxs("label",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",checked:b.isFeatured,onChange:e=>y({...b,isFeatured:e.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),t.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Featured"})]})]})]}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:g?"Update Plan":"Create Plan"})]})]})]}),t.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Plan"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pricing"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Limits"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map(e=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"flex items-center",children:t.jsxs("div",{children:[t.jsxs("div",{className:"text-sm font-medium text-gray-900 flex items-center",children:[e.name,e.isFeatured&&t.jsx("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800",children:"Featured"})]}),t.jsx("div",{className:"text-sm text-gray-500",children:e.description})]})})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsxs("div",{className:"text-sm text-gray-900",children:["$",e.priceMonthly,"/mo"]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["$",e.priceYearly,"/yr"]})]}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsxs("div",{className:"text-sm text-gray-900",children:[e.maxUsers," users, ",e.maxProjects," projects"]}),t.jsxs("div",{className:"text-sm text-gray-500",children:[e.storageGb,"GB storage, ",e.aiAgentsLimit," AI agents"]})]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full "+(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?"Active":"Inactive"})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[t.jsx("button",{onClick:()=>(e=>{h(e),y({name:e.name,description:e.description,priceMonthly:e.priceMonthly,priceYearly:e.priceYearly,maxUsers:e.maxUsers,maxProjects:e.maxProjects,features:e.features,aiAgentsIncluded:e.aiAgentsIncluded,aiAgentsLimit:e.aiAgentsLimit,storageGb:e.storageGb,isActive:e.isActive,isFeatured:e.isFeatured,sortOrder:e.sortOrder}),p(!0)})(e),className:"text-blue-600 hover:text-blue-900 mr-4",children:"Edit"}),t.jsx("button",{onClick:()=>(async(e,t)=>{try{await d(s,e,t),j()}catch(a){m(a.message||"Failed to update plan status")}})(e.id,!e.isActive),className:"hover:text-gray-900 "+(e.isActive?"text-red-600":"text-green-600"),children:e.isActive?"Deactivate":"Activate"})]})]},e.id))})]})})]})},v=({currentUser:s})=>{const[a,r]=e.useState([]),[l,n]=e.useState(!1),[i,c]=e.useState(null),[d,p]=e.useState(!1),[g,h]=e.useState(null),[b,y]=e.useState({name:"",description:"",category:"safety",priceMonthly:0,priceYearly:0,features:[],capabilities:[],iconUrl:"",bannerUrl:"",isActive:!0,isFeatured:!1,minPlan:"basic"});e.useEffect(()=>{j()},[]);const j=async()=>{n(!0),c(null);try{const e=await o();r(e)}catch(e){c(e.message||"Failed to load AI agents")}finally{n(!1)}},f=()=>{y({name:"",description:"",category:"safety",priceMonthly:0,priceYearly:0,features:[],capabilities:[],iconUrl:"",bannerUrl:"",isActive:!0,isFeatured:!1,minPlan:"basic"}),h(null),p(!1)};return l?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"AI Agents Marketplace Management"}),t.jsx("button",{onClick:()=>p(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Create New Agent"})]}),i&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:t.jsx("div",{className:"text-red-800",children:i})}),d&&t.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[t.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-4",children:g?"Edit AI Agent":"Create New AI Agent"}),t.jsxs("form",{onSubmit:g?async e=>{e.preventDefault(),c(null);try{await x(s,g.id,b),f(),j()}catch(t){c(t.message||"Failed to update AI agent")}}:async e=>{e.preventDefault(),c(null);try{await m(s,b),f(),j()}catch(t){c(t.message||"Failed to create AI agent")}},className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Agent Name"}),t.jsx("input",{type:"text",value:b.name,onChange:e=>y({...b,name:e.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter agent name",title:"Agent Name",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),t.jsxs("select",{value:b.category,onChange:e=>y({...b,category:e.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",title:"Category",children:[t.jsx("option",{value:"safety",children:"Safety"}),t.jsx("option",{value:"quality",children:"Quality"}),t.jsx("option",{value:"productivity",children:"Productivity"}),t.jsx("option",{value:"compliance",children:"Compliance"}),t.jsx("option",{value:"analytics",children:"Analytics"}),t.jsx("option",{value:"documentation",children:"Documentation"}),t.jsx("option",{value:"communication",children:"Communication"}),t.jsx("option",{value:"planning",children:"Planning"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),t.jsx("textarea",{value:b.description,onChange:e=>y({...b,description:e.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter agent description",title:"Description",rows:3,required:!0})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Monthly Price ($)"}),t.jsx("input",{type:"number",value:b.priceMonthly,onChange:e=>y({...b,priceMonthly:parseFloat(e.target.value)||0}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00",title:"Monthly Price",min:"0",step:"0.01"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Yearly Price ($)"}),t.jsx("input",{type:"number",value:b.priceYearly,onChange:e=>y({...b,priceYearly:parseFloat(e.target.value)||0}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00",title:"Yearly Price",min:"0",step:"0.01"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Icon URL"}),t.jsx("input",{type:"url",value:b.iconUrl,onChange:e=>y({...b,iconUrl:e.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://example.com/icon.png",title:"Icon URL"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Banner URL"}),t.jsx("input",{type:"url",value:b.bannerUrl,onChange:e=>y({...b,bannerUrl:e.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://example.com/banner.png",title:"Banner URL"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Minimum Plan"}),t.jsxs("select",{value:b.minPlan,onChange:e=>y({...b,minPlan:e.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",title:"Minimum Plan",children:[t.jsx("option",{value:"basic",children:"Basic"}),t.jsx("option",{value:"professional",children:"Professional"}),t.jsx("option",{value:"enterprise",children:"Enterprise"})]})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Features"}),t.jsx("button",{type:"button",onClick:()=>{y({...b,features:[...b.features,""]})},className:"text-blue-600 hover:text-blue-800 text-sm",children:"+ Add Feature"})]}),b.features.map((e,s)=>t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx("input",{type:"text",value:e,onChange:e=>((e,t)=>{const s=[...b.features];s[e]=t,y({...b,features:s})})(s,e.target.value),className:"flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter feature",title:`Feature ${s+1}`}),t.jsx("button",{type:"button",onClick:()=>(e=>{const t=b.features.filter((t,s)=>s!==e);y({...b,features:t})})(s),className:"text-red-600 hover:text-red-800",children:"‚úï"})]},s))]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Capabilities"}),t.jsx("button",{type:"button",onClick:()=>{y({...b,capabilities:[...b.capabilities,""]})},className:"text-blue-600 hover:text-blue-800 text-sm",children:"+ Add Capability"})]}),b.capabilities.map((e,s)=>t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx("input",{type:"text",value:e,onChange:e=>((e,t)=>{const s=[...b.capabilities];s[e]=t,y({...b,capabilities:s})})(s,e.target.value),className:"flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter capability",title:`Capability ${s+1}`}),t.jsx("button",{type:"button",onClick:()=>(e=>{const t=b.capabilities.filter((t,s)=>s!==e);y({...b,capabilities:t})})(s),className:"text-red-600 hover:text-red-800",children:"‚úï"})]},s))]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("label",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",checked:b.isActive,onChange:e=>y({...b,isActive:e.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),t.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Active"})]}),t.jsxs("label",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",checked:b.isFeatured,onChange:e=>y({...b,isFeatured:e.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),t.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Featured"})]})]}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:g?"Update Agent":"Create Agent"})]})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(e=>t.jsxs("div",{className:"bg-white rounded-lg shadow p-6 hover:shadow-lg transition-shadow",children:[t.jsxs("div",{className:"flex items-start justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:t.jsx("span",{className:"text-blue-600 font-bold text-lg",children:e.iconUrl?t.jsx("img",{src:e.iconUrl,alt:e.name,className:"w-8 h-8 rounded"}):"ü§ñ"})}),t.jsxs("div",{children:[t.jsxs("h4",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.name,e.isFeatured&&t.jsx("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800",children:"Featured"})]}),t.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full "+("safety"===e.category?"bg-red-100 text-red-800":"quality"===e.category?"bg-blue-100 text-blue-800":"productivity"===e.category?"bg-green-100 text-green-800":"bg-purple-100 text-purple-800"),children:e.category})]})]}),t.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full "+(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?"Active":"Inactive"})]}),t.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-3",children:e.description}),t.jsxs("div",{className:"mb-4",children:[t.jsxs("div",{className:"text-lg font-bold text-gray-900",children:["$",e.priceMonthly,"/mo"]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["$",e.priceYearly,"/yr"]})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("button",{onClick:()=>(e=>{h(e),y({name:e.name,description:e.description,category:e.category,priceMonthly:e.priceMonthly,priceYearly:e.priceYearly,features:e.features,capabilities:e.capabilities,iconUrl:e.iconUrl||"",bannerUrl:e.bannerUrl||"",isActive:e.isActive,isFeatured:e.isFeatured,minPlan:e.minPlan}),p(!0)})(e),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Edit"}),t.jsx("button",{onClick:()=>(async(e,t)=>{try{await u(s,e,t),j()}catch(a){c(a.message||"Failed to update agent status")}})(e.id,!e.isActive),className:"text-sm font-medium "+(e.isActive?"text-red-600 hover:text-red-800":"text-green-600 hover:text-green-800"),children:e.isActive?"Deactivate":"Activate"})]})]},e.id))}),0===a.length&&!l&&t.jsx("div",{className:"text-center py-12 text-gray-500",children:'No AI agents found. Click "Create New Agent" to get started.'})]})},N=({currentUser:s})=>{const[a,r]=e.useState([]),[l,n]=e.useState(!1),[i,c]=e.useState(null),[d,o]=e.useState(1),[x,m]=e.useState(1),[u,g]=e.useState({action:"",resourceType:"",userId:"",dateFrom:"",dateTo:""}),h=50;e.useEffect(()=>{b()},[d,u]);const b=async()=>{n(!0),c(null);try{const e=(d-1)*h;let t=await p(s,h,e);if(u.action&&(t=t.filter(e=>e.action.toLowerCase().includes(u.action.toLowerCase()))),u.resourceType&&(t=t.filter(e=>e.resourceType.toLowerCase().includes(u.resourceType.toLowerCase()))),u.userId&&(t=t.filter(e=>e.userId===u.userId)),u.dateFrom){const e=new Date(u.dateFrom);t=t.filter(t=>new Date(t.createdAt)>=e)}if(u.dateTo){const e=new Date(u.dateTo);e.setHours(23,59,59,999),t=t.filter(t=>new Date(t.createdAt)<=e)}r(t),m(Math.ceil(t.length/h))}catch(e){c(e.message||"Failed to load audit logs")}finally{n(!1)}},y=(e,t)=>{g({...u,[e]:t}),o(1)},j=(e,t)=>{if(!e&&!t)return"No changes recorded";const s=[];return t&&Object.keys(t).forEach(a=>{const r=e?.[a],l=t[a];r!==l&&s.push(`${a}: "${r||"null"}" ‚Üí "${l}"`)}),s.length>0?s.join(", "):"Details not available"},f=a.slice((d-1)*h,d*h);return l?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Platform Audit Log"}),t.jsxs("div",{className:"text-sm text-gray-600",children:["Total entries: ",a.length]})]}),i&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:t.jsx("div",{className:"text-red-800",children:i})}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[t.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-4",children:"Filters"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Action"}),t.jsx("input",{type:"text",value:u.action,onChange:e=>y("action",e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., invitation_sent",title:"Action Filter"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Resource Type"}),t.jsx("input",{type:"text",value:u.resourceType,onChange:e=>y("resourceType",e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., platform_invitation",title:"Resource Type Filter"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"User ID"}),t.jsx("input",{type:"text",value:u.userId,onChange:e=>y("userId",e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"User ID",title:"User ID Filter"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date From"}),t.jsx("input",{type:"date",value:u.dateFrom,onChange:e=>y("dateFrom",e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",title:"Date From Filter"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date To"}),t.jsx("input",{type:"date",value:u.dateTo,onChange:e=>y("dateTo",e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",title:"Date To Filter"})]}),t.jsx("div",{className:"flex items-end",children:t.jsx("button",{onClick:()=>{g({action:"",resourceType:"",userId:"",dateFrom:"",dateTo:""}),o(1)},className:"w-full bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors",children:"Clear Filters"})})]})]}),t.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Timestamp"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Resource"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Details"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:0===f.length?t.jsx("tr",{children:t.jsx("td",{colSpan:5,className:"px-6 py-4 text-center text-gray-500",children:0===a.length?"No audit logs found.":"No logs match the current filters."})}):f.map(e=>{return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(a=e.createdAt,new Date(a).toLocaleString())}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsx("div",{className:"text-sm text-gray-900",children:e.userId||"System"}),e.ipAddress&&t.jsxs("div",{className:"text-xs text-gray-500",children:["IP: ",e.ipAddress]})]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:"text-sm font-medium "+(s=e.action,s.includes("create")||s.includes("add")?"text-green-600":s.includes("update")||s.includes("change")?"text-blue-600":s.includes("delete")||s.includes("remove")?"text-red-600":s.includes("login")||s.includes("access")?"text-gray-600":"text-gray-900"),children:e.action.replace("_"," ")})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsx("div",{className:"text-sm text-gray-900",children:e.resourceType.replace("_"," ")}),e.resourceId&&t.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",e.resourceId]})]}),t.jsxs("td",{className:"px-6 py-4",children:[t.jsx("div",{className:"text-sm text-gray-900 max-w-xs truncate",children:j(e.oldValues,e.newValues)}),e.userAgent&&t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e.userAgent.substring(0,50),"..."]})]})]},e.id);var s,a})})]})}),x>1&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",(d-1)*h+1," to ",Math.min(d*h,a.length)," of ",a.length," entries"]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:()=>o(Math.max(1,d-1)),disabled:1===d,className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 disabled:bg-gray-50 disabled:text-gray-400",children:"Previous"}),t.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",d," of ",x]}),t.jsx("button",{onClick:()=>o(Math.min(x,d+1)),disabled:d===x,className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 disabled:bg-gray-50 disabled:text-gray-400",children:"Next"})]})]})]})},w=({currentUser:s,navigateTo:a,goBack:r})=>{const[l,n]=e.useState("dashboard");if("super_admin"!==s.role)return t.jsx("div",{className:"max-w-4xl mx-auto text-center py-12",children:t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-8",children:[t.jsx("div",{className:"text-red-600 text-6xl mb-4",children:"üö´"}),t.jsx("h2",{className:"text-2xl font-bold text-red-900 mb-2",children:"Access Denied"}),t.jsx("p",{className:"text-red-700 mb-4",children:"You need super administrator privileges to access the Platform Administration panel."}),t.jsx("button",{type:"button",onClick:r,className:"bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition-colors",children:"Go Back"})]})});return t.jsxs("div",{className:"max-w-7xl mx-auto",children:[t.jsxs("div",{className:"mb-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Platform Administration"}),t.jsx("p",{className:"text-gray-600 mt-2",children:"Central control panel for ConstructAI multi-tenant platform"})]}),t.jsx("button",{type:"button",onClick:r,className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition-colors",children:"‚Üê Back to Dashboard"})]}),t.jsxs("div",{className:"bg-gradient-to-r from-red-500 to-pink-600 text-white px-4 py-2 rounded-lg inline-flex items-center space-x-2",children:[t.jsx("span",{className:"text-lg",children:"üëë"}),t.jsx("span",{className:"font-semibold",children:"Super Administrator"}),t.jsxs("span",{className:"text-sm opacity-90",children:["(",s.email,")"]})]})]}),t.jsx("div",{className:"mb-8",children:t.jsx("div",{className:"border-b border-gray-200",children:t.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"dashboard",name:"Dashboard",icon:"üìä"},{id:"companies",name:"Companies",icon:"üè¢"},{id:"invitations",name:"Invitations",icon:"üìß"},{id:"plans",name:"Plans",icon:"üí≥"},{id:"agents",name:"AI Agents",icon:"ü§ñ"},{id:"audit",name:"Audit Log",icon:"üìú"}].map(e=>t.jsxs("button",{type:"button",onClick:()=>n(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm transition-colors "+(l===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[t.jsx("span",{className:"mr-2",children:e.icon}),e.name]},e.id))})})}),t.jsx("div",{className:"bg-gray-50 rounded-lg p-6",children:(()=>{switch(l){case"dashboard":default:return t.jsx(b,{currentUser:s,navigateTo:a});case"companies":return t.jsx(y,{currentUser:s});case"invitations":return t.jsx(j,{currentUser:s});case"plans":return t.jsx(f,{currentUser:s});case"agents":return t.jsx(v,{currentUser:s});case"audit":return t.jsx(N,{currentUser:s})}})()})]})};export{w as default};

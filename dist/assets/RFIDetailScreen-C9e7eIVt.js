import{r as e,j as s}from"./react-core-FGHlRSau.js";import{F as t,U as a,E as r,P as l,K as n,a0 as d,a1 as i,a2 as o}from"./module-screens-Dy02k3Q1.js";import"./vendor-BX0gT1qP.js";import"./google-ai-BrP-uSwO.js";import"./developer-tools-B-VjJpHg.js";import"./supabase-DKHGIEFa.js";import"./axios-ei4kQ0Q2.js";import"./icon-pack-tZfEXMDa.js";import"./monaco-Bh77eHRb.js";const c=({oldText:t,newText:a})=>{const r=e.useMemo(()=>{const e=t.split("\n"),s=a.split("\n"),r=[];let l=0,n=0;for(;n<s.length||l<e.length;)if(l<e.length&&n<s.length&&e[l]===s[n])r.push({type:"same",text:s[n]}),l++,n++;else{const t=l<e.length?s.indexOf(e[l],n):-1,a=n<s.length?e.indexOf(s[n],l):-1;if(-1!==t&&(t<=n||-1===a))for(;n<t;)r.push({type:"added",text:s[n]}),n++;else if(-1!==a)for(;l<a;)r.push({type:"removed",text:e[l]}),l++;else l<e.length&&(r.push({type:"removed",text:e[l]}),l++),n<s.length&&(r.push({type:"added",text:s[n]}),n++)}return r},[t,a]);return s.jsx("pre",{className:"text-sm bg-gray-50 p-3 rounded-md whitespace-pre-wrap font-sans",children:r.map((e,t)=>{let a="",r="";switch(e.type){case"added":a="bg-green-100 text-green-800",r="+ ";break;case"removed":a="bg-red-100 text-red-800",r="- ";break;default:a="text-gray-600",r="  "}return s.jsxs("div",{className:a,children:[s.jsx("span",{children:r}),s.jsx("span",{children:e.text})]},t)})})},m=e=>{switch(e){case"Open":return"bg-red-100 text-red-800 border-2 border-red-300";case"Closed":return"bg-green-100 text-green-800 border-2 border-green-300";case"Draft":return"bg-yellow-100 text-yellow-800 border-2 border-yellow-300";default:return"bg-gray-100 text-gray-800 border-2 border-gray-300"}},x=({label:e,isActive:t,onClick:a})=>s.jsx("button",{onClick:a,className:"px-4 py-2 text-sm font-semibold rounded-md "+(t?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-200"),children:e}),h=({rfiId:h,project:p,goBack:g,currentUser:u})=>{const[b,j]=e.useState(null),[f,y]=e.useState([]),[N,v]=e.useState(!0),[w,D]=e.useState("details"),[C,S]=e.useState(null),[A,k]=e.useState(""),[P,T]=e.useState(""),[F,R]=e.useState([]),[L,O]=e.useState(!1);e.useEffect(()=>{(async()=>{v(!0);const e=await d(h);if(e){const s=await i(e.rfiNumber);y(s);const t=s[s.length-1];j(t),s.length>1&&S(s[s.length-2].id)}else j(null),y([]);v(!1)})()},[h]);const I=e=>{e&&R(s=>[...s,...Array.from(e)])};if(N)return s.jsx("div",{className:"text-center p-8",children:"Loading RFI details..."});if(!b)return s.jsx("div",{className:"text-center p-8 text-red-500",children:"RFI not found."});const U=f.find(e=>e.id===C)||null,V=(e=>{if("Open"!==e.status)return!1;const s=new Date;return s.setHours(0,0,0,0),new Date(e.dueDate)<s})(b),q="company_admin"===u.role||"Project Manager"===u.role;return s.jsxs("div",{className:"flex flex-col h-full max-w-4xl mx-auto",children:[s.jsxs("header",{className:"bg-white p-4 flex items-center border-b mb-8",children:[s.jsx("button",{onClick:g,className:"mr-4 p-2 rounded-full hover:bg-gray-100",children:s.jsx(t,{className:"w-6 h-6 text-gray-600"})}),s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold text-gray-900 truncate",title:b.subject,children:[b.rfiNumber,": ",b.subject]}),s.jsx("p",{className:"text-sm text-gray-500",children:p.name})]})]}),s.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2 p-1 bg-gray-100 rounded-lg",children:[s.jsx(x,{label:"Details",isActive:"details"===w,onClick:()=>D("details")}),s.jsx(x,{label:"History & Comparison",isActive:"comparison"===w,onClick:()=>D("comparison")})]}),s.jsxs("span",{className:"text-sm font-semibold text-gray-500",children:["Version: ",b.version]})]}),s.jsxs("main",{className:"flex-grow space-y-6",children:["details"===w&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-100 p-6 grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("h3",{className:"font-bold text-lg text-gray-800 mb-2",children:"Question"}),s.jsx("p",{className:"text-gray-600 whitespace-pre-wrap",children:b.question})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase",children:"Status"}),s.jsx("p",{className:`font-bold py-1 px-2 rounded-full inline-block text-xs mt-1 ${m(b.status)}`,children:b.status})]}),s.jsxs("div",{children:[s.jsxs("p",{className:"text-xs font-bold text-gray-500 uppercase mb-1 flex items-center gap-1.5",children:[s.jsx(a,{className:"w-4 h-4"}),"Assigned To"]}),s.jsx("p",{className:"text-gray-800 font-semibold",children:b.assignee})]}),s.jsxs("div",{children:[s.jsxs("p",{className:"text-xs font-bold uppercase mb-1 flex items-center gap-1.5 "+(V?"text-red-600":"text-gray-500"),children:[s.jsx(r,{className:"w-4 h-4"}),"Response Due"]}),s.jsx("p",{className:"font-semibold "+(V?"text-red-600":"text-gray-800"),children:new Date(b.dueDate).toLocaleDateString()})]})]})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-100 p-6",children:[s.jsx("h3",{className:"font-bold text-lg text-gray-800 mb-4",children:"Official Response"}),"Closed"===b.status&&b.response?s.jsxs("div",{className:"p-4 bg-green-50 border-l-4 border-green-400 rounded-r-md",children:[s.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:b.response}),s.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Answered by ",b.answeredBy]}),b.responseAttachments&&b.responseAttachments.length>0&&s.jsxs("div",{className:"mt-4",children:[s.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-2",children:"Attachments:"}),s.jsx("ul",{className:"space-y-2",children:b.responseAttachments.map((e,t)=>s.jsxs("li",{className:"flex items-center gap-2",children:[s.jsx(l,{className:"w-4 h-4 text-gray-500"}),s.jsx("a",{href:e.url,className:"text-sm text-blue-600 hover:underline",children:e.name})]},t))})]})]}):q?s.jsxs("div",{children:[s.jsx("textarea",{rows:4,value:P,onChange:e=>T(e.target.value),placeholder:"Type the official response here...",className:"w-full p-2 border border-gray-300 rounded-md"}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Attachments"}),s.jsx("div",{onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),O(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),O(!1)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{e.preventDefault(),e.stopPropagation(),O(!1),e.dataTransfer.files&&e.dataTransfer.files.length>0&&I(e.dataTransfer.files)},className:"mt-2 flex justify-center rounded-lg border border-dashed px-6 py-10 transition-colors "+(L?"border-blue-600 bg-blue-50":"border-gray-900/25"),children:s.jsxs("div",{className:"text-center",children:[s.jsx(l,{className:"mx-auto h-12 w-12 text-gray-300"}),s.jsxs("div",{className:"mt-4 flex text-sm text-gray-600",children:[s.jsxs("label",{htmlFor:"file-upload",className:"relative cursor-pointer rounded-md bg-white font-semibold text-blue-600 hover:text-blue-500",children:[s.jsx("span",{children:"Upload a file"}),s.jsx("input",{id:"file-upload",type:"file",className:"sr-only",onChange:e=>{e.target.files&&I(e.target.files),e.target&&(e.target.value="")},multiple:!0})]}),s.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),s.jsx("p",{className:"text-xs text-gray-600",children:"PDF, PNG, JPG up to 10MB"})]})}),F.length>0&&s.jsx("div",{className:"mt-4 space-y-2",children:F.map((e,t)=>s.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-100 rounded-md text-sm",children:[s.jsx("span",{className:"font-medium text-gray-700 truncate",children:e.name}),s.jsx("button",{onClick:()=>{return e=t,void R(s=>s.filter((s,t)=>t!==e));var e},className:"p-1 text-gray-400 hover:text-red-500",children:s.jsx(n,{className:"w-4 h-4"})})]},t))})]}),s.jsx("div",{className:"text-right mt-4",children:s.jsx("button",{onClick:async()=>{if(!b||!P.trim())return void alert("Please enter an answer before submitting.");const e=await Promise.all(F.map(e=>new Promise((s,t)=>{const a=new FileReader;a.onload=t=>{s({name:e.name,url:t.target?.result})},a.onerror=t,a.readAsDataURL(e)}))),s=await o(b.id,P,e,u);s&&j(s),T(""),R([])},className:"px-4 py-2 bg-blue-600 text-white font-bold rounded-md hover:bg-blue-700",children:"Submit Answer & Close RFI"})})]}):s.jsx("p",{className:"text-sm text-gray-500",children:"Awaiting response from the assigned party."})]}),s.jsx("div",{className:"bg-white rounded-lg shadow-md border border-gray-100 p-6",children:s.jsxs("h3",{className:"font-bold text-lg text-gray-800 mb-4",children:["Comments (",b.comments.length,")"]})})]}),"comparison"===w&&s.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-100 p-6",children:[s.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[s.jsx("label",{htmlFor:"comparison-version",className:"font-semibold text-gray-700",children:"Compare latest version with:"}),s.jsx("select",{id:"comparison-version",value:C||"",onChange:e=>S(e.target.value),className:"p-2 border border-gray-300 rounded-md bg-white",children:f.filter(e=>e.id!==b.id).map(e=>s.jsxs("option",{value:e.id,children:["Version ",e.version," (",new Date(e.history?.[e.history.length-1]?.timestamp||"").toLocaleDateString(),")"]},e.id))})]}),(()=>{if(!U)return s.jsx("p",{className:"text-center text-gray-500 p-8",children:"Select a version to compare."});const e=new Set(U.attachments.map(e=>e.name)),t=new Set(b.attachments.map(e=>e.name));return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold text-gray-800 mb-2",children:"Question"}),s.jsx(c,{oldText:U.question,newText:b.question})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold text-gray-800 mb-2",children:"Response"}),s.jsx(c,{oldText:U.response||"",newText:b.response||""})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold text-gray-800 mb-2",children:"Attachments"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-gray-50 p-3 rounded-md",children:[s.jsxs("h5",{className:"font-semibold text-sm mb-2",children:["Version ",U.version]}),s.jsx("ul",{className:"list-disc list-inside text-sm space-y-1",children:U.attachments.map(e=>s.jsx("li",{className:t.has(e.name)?"":"text-red-600",children:e.name},e.name))})]}),s.jsxs("div",{className:"bg-gray-50 p-3 rounded-md",children:[s.jsxs("h5",{className:"font-semibold text-sm mb-2",children:["Version ",b.version," (Latest)"]}),s.jsx("ul",{className:"list-disc list-inside text-sm space-y-1",children:b.attachments.map(t=>s.jsx("li",{className:e.has(t.name)?"":"text-green-600",children:t.name},t.name))})]})]})]})]})})()]})]})]})};export{h as default};

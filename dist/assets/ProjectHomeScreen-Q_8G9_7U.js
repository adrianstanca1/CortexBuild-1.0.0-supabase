import{r as e,j as s}from"./react-core-FGHlRSau.js";import{L as t,n as a,P as r,x as l,t as i,y as n,g as c,z as d,h as o,Q as x,E as m,F as g,M as h,B as u,U as j}from"./module-screens-Dy02k3Q1.js";import{Q as p}from"./QuickActionsWidget-CUrzXUss.js";import"./vendor-BX0gT1qP.js";import"./google-ai-BrP-uSwO.js";import"./developer-tools-B-VjJpHg.js";import"./supabase-DKHGIEFa.js";import"./axios-ei4kQ0Q2.js";import"./icon-pack-tZfEXMDa.js";import"./monaco-Bh77eHRb.js";const b=e=>{if("Done"===e.status)return!1;const s=new Date;return s.setHours(0,0,0,0),new Date(e.dueDate)<s},f=e=>{if(e.assignee)return`To: ${e.assignee}`;if(e.targetRoles&&e.targetRoles.length>0){const s=e.targetRoles[0];return`To: All ${s.charAt(0).toUpperCase()+s.slice(1)}s`}return"Unassigned"},N=({task:e})=>{if(b(e))return s.jsx(i,{className:"w-6 h-6 text-red-500",title:"Overdue"});switch(e.status){case"Done":return s.jsx(c,{className:"w-6 h-6 text-green-500",title:"Done"});case"In Progress":return s.jsx(n,{className:"w-6 h-6 text-blue-500",title:"In Progress"});case"To Do":return s.jsx(t,{className:"w-6 h-6 text-gray-400",title:"To Do"});default:return s.jsx("div",{className:"w-6 h-6"})}},y=({project:i,navigateTo:n,currentUser:c})=>{const[d,o]=e.useState([]),[x,m]=e.useState(!0);return e.useEffect(()=>{(async()=>{if(!i?.id)return void m(!1);m(!0);const e=(await l(i.id,c)).filter(e=>"Done"!==e.status).sort((e,s)=>new Date(e.dueDate).getTime()-new Date(s.dueDate).getTime());o(e),m(!1)})()},[i?.id,c]),s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-100",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsxs("h2",{className:"text-lg font-bold text-gray-800 flex items-center",children:[s.jsx(t,{className:"w-6 h-6 mr-2 text-gray-500"}),"Open Tasks"]}),s.jsxs("button",{onClick:()=>n("tasks"),className:"text-sm font-semibold text-blue-600 hover:underline flex items-center gap-1",children:["View All (",d.length,") ",s.jsx(a,{className:"w-4 h-4"})]})]}),x?s.jsx("p",{className:"text-gray-500 text-center py-4",children:"Loading tasks..."}):0===d.length?s.jsx("p",{className:"text-gray-500 text-center py-4",children:"No open tasks for this project."}):s.jsx("ul",{className:"divide-y divide-gray-200",children:d.slice(0,5).map(e=>{const t=b(e);return s.jsxs("li",{onClick:()=>n("task-detail",{taskId:e.id}),className:"p-3 flex items-center justify-between hover:bg-gray-50 cursor-pointer "+(t?"bg-red-50":""),children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(N,{task:e}),s.jsxs("div",{children:[s.jsxs("p",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.title,e.attachments&&e.attachments.length>0&&s.jsx(r,{className:"w-4 h-4 text-gray-400"})]}),s.jsx("p",{className:"text-sm text-gray-500",children:f(e)})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-sm font-semibold "+(t?"text-red-600":"text-gray-600"),children:new Date(e.dueDate).toLocaleDateString()}),s.jsx("p",{className:"text-xs text-gray-500",children:"Due Date"})]})]},e.id)})})]})},v={rfi:x,overdue:i,"tm-ticket":o,"ai-risk":d},w={rfi:"text-red-600",overdue:"text-amber-600","tm-ticket":"text-orange-600","ai-risk":"text-teal-600"},k={rfi:"bg-red-100",overdue:"bg-amber-100","tm-ticket":"bg-orange-100","ai-risk":"bg-teal-100"},D=({label:e,value:t,type:a})=>{const r=v[a],l=w[a],i=k[a];return s.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-lg border border-gray-100 flex items-center space-x-4 transition-all duration-300 ease-in-out hover:shadow-xl hover:-translate-y-1",children:[s.jsx("div",{className:`p-3 rounded-full ${i}`,children:s.jsx(r,{className:`w-7 h-7 ${l}`})}),s.jsxs("div",{children:[s.jsx("p",{className:`text-2xl font-bold ${l}`,children:t}),s.jsx("p",{className:"text-sm text-gray-500 font-semibold",children:e})]})]})},T=({currentUser:t,project:a,navigateTo:r})=>{const[i,n]=e.useState([]),[c,d]=e.useState(!0);return e.useEffect(()=>{(async()=>{if(!a?.id)return void d(!1);d(!0);const e=(await l(a.id,t)).filter(e=>e.assignee===t.name||e.targetRoles&&e.targetRoles.includes(t.role)).filter(e=>"Done"!==e.status&&new Date(e.dueDate)>=new Date).sort((e,s)=>new Date(e.dueDate).getTime()-new Date(s.dueDate).getTime());n(e),d(!1)})()},[t,a?.id]),s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-100",children:[s.jsxs("h2",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[s.jsx(m,{className:"w-6 h-6 text-gray-500"})," My Upcoming Deadlines"]}),c?s.jsx("p",{className:"text-gray-500 text-center py-4",children:"Loading deadlines..."}):0===i.length?s.jsx("p",{className:"text-gray-500 text-center py-4",children:"No upcoming deadlines for you on this project."}):s.jsx("ul",{className:"divide-y divide-gray-200",children:i.slice(0,5).map(e=>s.jsxs("li",{onClick:()=>r("task-detail",{taskId:e.id}),className:"py-3 flex items-center justify-between hover:bg-gray-50 cursor-pointer -mx-3 px-3 rounded-lg",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold text-sm text-gray-800",children:e.title}),s.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Status: ",s.jsx("span",{className:"font-medium",children:e.status})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-sm font-semibold text-red-600",children:new Date(e.dueDate).toLocaleDateString()}),s.jsx("p",{className:"text-xs text-gray-500",children:"Due Date"})]})]},e.id))})]})},R=({project:t,navigateTo:a,goBack:r,currentUser:l})=>{if(e.useEffect(()=>{t||r()},[t,r]),!t)return null;return s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsxs("header",{className:"bg-white p-4 flex items-center border-b mb-8",children:[s.jsx("button",{onClick:r,className:"mr-4 p-2 rounded-full hover:bg-gray-100",children:s.jsx(g,{className:"w-6 h-6 text-gray-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t.name}),s.jsxs("p",{className:"text-sm text-gray-500 flex items-center",children:[s.jsx(h,{className:"w-4 h-4 mr-1"}),t.location]})]})]}),s.jsxs("main",{className:"flex-grow space-y-8",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[s.jsx(D,{label:"Open RFIs",value:t.snapshot.openRFIs,type:"rfi"}),s.jsx(D,{label:"Overdue Tasks",value:t.snapshot.overdueTasks,type:"overdue"}),s.jsx(D,{label:"Pending T&M",value:t.snapshot.pendingTMTickets,type:"tm-ticket"}),s.jsx(D,{label:"AI Risk Level",value:t.snapshot.aiRiskLevel,type:"ai-risk"})]}),s.jsx(p,{onQuickAction:a,onSuggestAction:()=>{},isGlobal:!1,currentUser:l}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[s.jsx(y,{project:t,navigateTo:a,currentUser:l}),s.jsx(T,{project:t,navigateTo:a,currentUser:l})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-100",children:[s.jsxs("h2",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center",children:[s.jsx(u,{className:"w-6 h-6 mr-2 text-gray-500"}),"Project Overview"]}),s.jsx("p",{className:"text-gray-600",children:t.description}),s.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200",children:[s.jsx("h3",{className:"text-sm font-semibold text-gray-600 mb-3",children:"Quick Links"}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[{label:"Tasks",screen:"tasks"},{label:"RFIs",screen:"rfis"},{label:"Punch List",screen:"punch-list"},{label:"Drawings",screen:"drawings"}].map(e=>s.jsx("button",{onClick:()=>a(e.screen),className:"w-full text-center px-4 py-2 bg-slate-100 text-slate-700 font-semibold rounded-md hover:bg-blue-100 hover:text-blue-700 transition-colors text-sm",children:e.label},e.screen))})]})]}),s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-100",children:[s.jsxs("h2",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center",children:[s.jsx(j,{className:"w-6 h-6 mr-2 text-gray-500"}),"Key Contacts"]}),s.jsx("ul",{className:"space-y-3",children:t.contacts.map(e=>s.jsxs("li",{className:"flex justify-between items-center text-sm",children:[s.jsx("span",{className:"font-semibold text-gray-700",children:e.role}),s.jsx("span",{className:"text-gray-600",children:e.name})]},e.name))})]})]})]})]})};export{R as default};

import{j as e,r as s,R as t}from"./react-core-FGHlRSau.js";import a from"./PlatformAdminScreen-BGLYfKt7.js";import r from"./SuperAdminDashboardScreen-BQXmOMkk.js";import{L as l,n as i,o as n,C as d,g as o,f as c,p as x,q as m,r as g,k as h,t as u,u as p,w as b}from"./module-screens-Dy02k3Q1.js";import{Q as j}from"./QuickActionsWidget-CUrzXUss.js";import{S as y,a as N,N as f,P as v,p as w,c as k,C as D}from"./CompanyAdminDashboardScreen-D4R3urUu.js";import{E as T,D as S}from"./developer-tools-B-VjJpHg.js";import"./vendor-BX0gT1qP.js";import"./axios-ei4kQ0Q2.js";import"./icon-pack-tZfEXMDa.js";import"./google-ai-BrP-uSwO.js";import"./supabase-DKHGIEFa.js";import"./monaco-Bh77eHRb.js";const L=({tasks:s,onDeepLink:t})=>{const a=s.filter(e=>"Done"!==e.status).sort((e,s)=>new Date(e.dueDate).getTime()-new Date(s.dueDate).getTime());return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg border border-gray-100 h-full flex flex-col transition-all duration-300 ease-in-out hover:shadow-xl hover:-translate-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(l,{className:"w-6 h-6 text-gray-500"})," My Open Tasks"]}),a.length>5&&e.jsxs("span",{className:"text-sm font-semibold text-blue-600",children:[a.length," total"]})]}),0===a.length?e.jsx("p",{className:"text-gray-500 flex-grow flex items-center justify-center",children:"No open tasks assigned to you."}):e.jsx("ul",{className:"divide-y divide-gray-200",children:a.slice(0,5).map(s=>e.jsxs("li",{onClick:()=>t(s.projectId,"task-detail",{taskId:s.id}),className:"py-3 flex items-center justify-between hover:bg-gray-50 cursor-pointer -mx-3 px-3 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:s.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Due: ",new Date(s.dueDate).toLocaleDateString()]})]}),e.jsx(i,{className:"w-5 h-5 text-gray-400"})]},s.id))})]})},A=({activities:s,onDeepLink:t})=>{const a={comment:n,photo:c,status_change:o,log_submitted:d},r={comment:"text-blue-600",photo:"text-purple-600",status_change:"text-green-600",log_submitted:"text-gray-600"},l={comment:"bg-blue-100",photo:"bg-purple-100",status_change:"bg-green-100",log_submitted:"bg-gray-100"};return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-100 h-full flex flex-col",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(n,{className:"w-6 h-6 text-gray-500"}),"Recent Project Activity"]}),0===s.length?e.jsx("p",{className:"text-gray-500 flex-grow flex items-center justify-center",children:"No recent activity."}):e.jsx("ul",{className:"space-y-2",children:s.slice(0,5).map(s=>{const i=a[s.type];return e.jsxs("li",{onClick:()=>t(s.projectId,s.link.screen,s.link.params),className:"flex items-start gap-4 p-3 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("div",{className:`flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ${l[s.type]}`,children:e.jsx(i,{className:`w-6 h-6 ${r[s.type]}`})}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"text-gray-800",children:[e.jsx("span",{className:"font-bold",children:s.author})," ",s.description]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:["in ",e.jsx("span",{className:"font-semibold",children:s.projectName})," · ",new Date(s.timestamp).toLocaleDateString()]})]})]},s.id)})})]})},C=t=>{const{currentUser:a,navigateTo:r,onDeepLink:l,onQuickAction:i,onSuggestAction:n}=t,[d,o]=s.useState([]),[c,u]=s.useState([]),[p,b]=s.useState([]),[k,D]=s.useState(null),[T,S]=s.useState(!0);s.useEffect(()=>{(async()=>{S(!0);try{const[e,s,t]=await Promise.all([m(a),g(a),h(a)]);o(e),u(s),b(t);const r=await w(t,e,a);D(r)}catch(e){}finally{S(!1)}})(),x(a)},[a]);return T?e.jsxs("div",{className:"space-y-8 animate-pulse",children:[e.jsxs("header",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]}),e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-200"})]}),e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsx("div",{className:"h-64 bg-gray-200 rounded-lg"}),e.jsx("div",{className:"h-96 bg-gray-200 rounded-lg"})]}),e.jsxs("div",{className:"lg:col-span-1 space-y-8",children:[e.jsx("div",{className:"h-96 bg-gray-200 rounded-lg"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded-lg"})]})]})]}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("header",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Supervisor Dashboard"}),e.jsxs("p",{className:"text-md text-gray-500",children:["Welcome, ",a.name,"! 👷"]})]}),e.jsx("img",{src:a.avatar,alt:"User Avatar",className:"w-12 h-12 rounded-full shadow-lg border-2 border-purple-200"})]}),k&&e.jsx(y,{metrics:k.metrics,trends:k.trends}),e.jsx(j,{onQuickAction:i,onSuggestAction:n,isGlobal:!0,currentUser:a}),e.jsxs("main",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[k&&e.jsx(N,{insights:k.insights,onNavigate:e=>{r("project-detail",{projectId:e})}}),e.jsx(L,{tasks:d,onDeepLink:l}),e.jsx(A,{activities:c,onDeepLink:l})]}),e.jsxs("div",{className:"lg:col-span-1 space-y-8",children:[e.jsx(f,{currentUser:a,onDeepLink:l}),e.jsx(v,{projects:p,navigateTo:r,onDeepLink:l})]})]})]})},P=({firstTask:s,metrics:t,userName:a})=>{const r=t.totalTasks>0?t.completedTasks/t.totalTasks*100:0;return e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl shadow-2xl p-8 text-white",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold mb-2",children:[(()=>{const e=(new Date).getHours();return e<12?"Good Morning":e<18?"Good Afternoon":"Good Evening"})(),", ",a.split(" ")[0],"! 👋"]}),e.jsx("p",{className:"text-blue-100 text-lg",children:"Let's make today productive"})]}),e.jsxs("div",{className:`rounded-lg p-6 mb-6 border-2 ${(e=>{if(!e)return"bg-gray-100 border-gray-300";const s=new Date(e.dueDate),t=new Date,a=Math.ceil((s.getTime()-t.getTime())/864e5);return a<0?"bg-red-50 border-red-300":a<=1?"bg-orange-50 border-orange-300":a<=3?"bg-yellow-50 border-yellow-300":"bg-green-50 border-green-300"})(s)} bg-white bg-opacity-95`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Today's Priority"}),s&&e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:(e=>{if(!e)return"No tasks";const s=new Date(e.dueDate),t=new Date,a=Math.ceil((s.getTime()-t.getTime())/864e5);return a<0?"🚨 Overdue":0===a?"⚡ Due Today":1===a?"⏰ Due Tomorrow":a<=3?"📅 Due This Week":"✅ On Track"})(s)})]}),s?e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:s.title}),s.description&&e.jsx("p",{className:"text-gray-700 text-sm",children:s.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"📍"}),e.jsx("span",{children:s.projectName||"Project"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"📅"}),e.jsxs("span",{children:["Due: ",new Date(s.dueDate).toLocaleDateString()]})]})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("span",{className:"text-4xl mb-2 block",children:"🎉"}),e.jsx("p",{className:"text-gray-700 font-semibold",children:"All caught up!"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"No urgent tasks for today"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white bg-opacity-20 backdrop-blur-sm rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold mb-1",children:t.upcomingTasks}),e.jsx("div",{className:"text-xs text-blue-100",children:"Tasks This Week"})]}),e.jsxs("div",{className:"bg-white bg-opacity-20 backdrop-blur-sm rounded-lg p-4 text-center",children:[e.jsxs("div",{className:"text-3xl font-bold mb-1",children:[r.toFixed(0),"%"]}),e.jsx("div",{className:"text-xs text-blue-100",children:"Completion Rate"})]}),e.jsxs("div",{className:"bg-white bg-opacity-20 backdrop-blur-sm rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold mb-1",children:t.overdueTasks}),e.jsx("div",{className:"text-xs text-blue-100",children:"Overdue Tasks"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-semibold",children:"Today's Progress"}),e.jsxs("span",{className:"text-sm",children:[t.completedTasks," / ",t.totalTasks]})]}),e.jsx("div",{className:"w-full bg-white bg-opacity-30 rounded-full h-3",children:e.jsx("div",{className:"bg-white rounded-full h-3 transition-all duration-500",style:{width:`${r}%`}})})]}),e.jsxs("div",{className:"mt-6 text-center",children:[r>=80&&e.jsx("p",{className:"text-sm font-semibold",children:"🌟 Excellent work! Keep it up!"}),r>=50&&r<80&&e.jsx("p",{className:"text-sm font-semibold",children:"💪 Great progress! You're doing well!"}),r<50&&t.totalTasks>0&&e.jsx("p",{className:"text-sm font-semibold",children:"🚀 Let's get started! You've got this!"}),0===t.totalTasks&&e.jsx("p",{className:"text-sm font-semibold",children:"✨ Ready for new challenges!"})]})]})},I=({currentUser:t,navigateTo:a,onDeepLink:r})=>{const[i,n]=s.useState(null),[o,c]=s.useState([]),[x,g]=s.useState([]),[h,j]=s.useState(null),[y,N]=s.useState(!0);s.useEffect(()=>{(async()=>{N(!0);const e=(new Date).toISOString().split("T")[0],[s,a,r]=await Promise.all([m(t),p(),b(t.id,e)]),l=s.filter(e=>"Done"!==e.status).sort((e,s)=>new Date(e.dueDate).getTime()-new Date(s.dueDate).getTime());c(s),n(l.length>0?l[0]:null),g(a),j(r),N(!1)})()},[t]);const f=k([],o);return e.jsxs("div",{className:"space-y-8",children:[!y&&e.jsx(P,{firstTask:i,metrics:f,userName:t.name}),y?e.jsx("div",{className:"text-center p-8 text-gray-500",children:"Loading your workday..."}):e.jsxs("main",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-8",children:[i?e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg border border-gray-100",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800 mb-3",children:"First Task Up"}),e.jsxs("div",{onClick:()=>r(i.projectId,"task-detail",{taskId:i.id}),className:"p-4 bg-blue-50 border border-blue-200 rounded-lg cursor-pointer hover:bg-blue-100",children:[e.jsx("p",{className:"font-bold text-blue-800",children:i.title}),e.jsxs("p",{className:"text-sm text-red-600 font-semibold mt-1",children:["Due: ",new Date(i.dueDate).toLocaleDateString()]})]})]}):e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg border border-gray-100",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800 mb-3",children:"First Task Up"}),e.jsxs("div",{className:"p-4 bg-green-50 text-green-800 text-center rounded-lg",children:[e.jsx("p",{children:"No open tasks. Great job!"}),e.jsx("button",{onClick:()=>a("my-tasks"),className:"mt-4 px-4 py-2 bg-green-600 text-white font-bold rounded-md hover:bg-green-700",children:"View All Tasks"})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg border border-gray-100",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(l,{className:"w-6 h-6 text-gray-500"})," All My Tasks"]}),e.jsx("button",{onClick:()=>a("my-tasks"),className:"w-full px-4 py-3 bg-blue-600 text-white font-bold rounded-md hover:bg-blue-700",children:"View All My Tasks"})]})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg border border-gray-100",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(d,{className:"w-6 h-6 text-gray-500"})," Daily Log"]}),e.jsx("button",{onClick:()=>{const e=i?.projectId;e&&r(e,"daily-log",{})},disabled:!i,title:i?h?"View or edit today's log":"Start a new daily log":"You must have an active task on a project to create a daily log",className:`w-full px-4 py-3 font-bold rounded-md transition-colors ${h?"bg-green-600 text-white hover:bg-green-700":"bg-yellow-400 text-yellow-900 hover:bg-yellow-500"} disabled:bg-gray-300 disabled:cursor-not-allowed`,children:h?"View/Edit Today's Log":`Start Daily Log for ${i?.projectName||"Project"}`})]}),x.length>0&&e.jsxs("div",{className:"bg-orange-50 rounded-lg shadow-lg border border-orange-200 p-6",children:[e.jsxs("h2",{className:"text-lg font-bold text-orange-800 mb-4 flex items-center gap-2",children:[e.jsx(u,{className:"w-6 h-6 text-orange-600"})," Recent Site Instructions"]}),e.jsx("ul",{className:"space-y-3",children:x.map(s=>e.jsxs("li",{className:"p-4 bg-white/70 backdrop-blur-sm border-l-4 border-orange-500 rounded-r-md shadow-sm",children:[e.jsx("p",{className:"text-gray-800 font-medium",children:s.text}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2 text-right",children:["- ",s.author]})]},s.id))})]})]})]})]})},U=s=>{const{currentUser:l}=s,[i,n]=t.useState(!0);switch(l.role){case"super_admin":return i?e.jsxs("div",{children:[e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsx("button",{type:"button",onClick:()=>n(!1),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Switch to Platform Admin"})}),e.jsx(r,{})]}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsx("button",{type:"button",onClick:()=>n(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Back to Super Admin Dashboard"})}),e.jsx(a,{...s})]});case"developer":return e.jsx(S,{currentUser:l,navigateTo:s.navigateTo});case"company_admin":return e.jsx(D,{...s});case"Project Manager":case"Accounting Clerk":default:return e.jsx(T,{});case"Foreman":case"Safety Officer":return e.jsx(C,{...s});case"operative":return e.jsx(I,{...s})}};export{U as default};

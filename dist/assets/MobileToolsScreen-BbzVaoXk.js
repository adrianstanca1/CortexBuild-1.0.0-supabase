import{r as e,j as s,R as t}from"./react-core-FGHlRSau.js";import{ae as a,bn as l,bo as r,X as i,U as n,ad as c,s as o,a3 as d,ac as x,H as m,al as h,ak as g,af as u}from"./icon-pack-tZfEXMDa.js";import"./vendor-BX0gT1qP.js";const p=({projectId:t,taskId:h,onPhotoCapture:g,onClose:u,className:p=""})=>{const[j,b]=e.useState(!1),[f,v]=e.useState([]),[N,w]=e.useState(null),[y,C]=e.useState(navigator.onLine),[k,S]=e.useState(null),[L,P]=e.useState(""),[E,O]=e.useState([]),[I,R]=e.useState(""),T=e.useRef(null),U=e.useRef(null),D=e.useRef(null);e.useEffect(()=>{const e=()=>C(!0),s=()=>C(!1);return window.addEventListener("online",e),window.addEventListener("offline",s),navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{S({latitude:e.coords.latitude,longitude:e.coords.longitude,address:"Location detected"})},e=>{}),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s)}},[]);const M=()=>{if(U.current&&U.current.srcObject){U.current.srcObject.getTracks().forEach(e=>e.stop()),U.current.srcObject=null}b(!1)},F=()=>{I.trim()&&!E.includes(I.trim())&&(O(e=>[...e,I.trim()]),R(""))},$=()=>{w(null),P(""),O([])};return s.jsx("div",{className:`photo-capture ${p}`,children:s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(a,{className:"w-6 h-6 text-blue-600"}),s.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Photo Capture"}),s.jsx("div",{className:"flex items-center gap-1",children:y?s.jsx(l,{className:"w-4 h-4 text-green-600"}):s.jsx(r,{className:"w-4 h-4 text-red-600"})})]}),s.jsx("button",{onClick:u,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-md",children:s.jsx(i,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"p-4",children:[N?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx("img",{src:N.preview,alt:"Captured photo",className:"w-full h-64 object-cover rounded-lg"}),s.jsx("div",{className:"absolute top-2 right-2 flex gap-2",children:s.jsx("button",{onClick:$,className:"p-2 bg-white bg-opacity-80 rounded-full hover:bg-opacity-100",children:s.jsx(d,{className:"w-4 h-4 text-gray-600"})})})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[s.jsx(x,{className:"w-4 h-4"}),s.jsx("span",{children:new Date(N.metadata.timestamp).toLocaleString()})]}),N.metadata.location&&s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[s.jsx(c,{className:"w-4 h-4"}),s.jsxs("span",{children:[N.metadata.location.latitude.toFixed(4),", ",N.metadata.location.longitude.toFixed(4)]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags"}),s.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:E.map(e=>s.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:[e,s.jsx("button",{onClick:()=>{return s=e,void O(e=>e.filter(e=>e!==s));var s},className:"hover:text-blue-600",children:s.jsx(i,{className:"w-3 h-3"})})]},e))}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:I,onChange:e=>R(e.target.value),placeholder:"Add tag...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-500",onKeyPress:e=>"Enter"===e.key&&F()}),s.jsx("button",{onClick:F,className:"px-3 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700",children:"Add"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),s.jsx("textarea",{value:L,onChange:e=>P(e.target.value),placeholder:"Add notes about this photo...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("button",{onClick:$,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50",children:[s.jsx(d,{className:"w-4 h-4"}),"Retake"]}),s.jsxs("button",{onClick:()=>{N&&(g(N),w(null),P(""),O([]))},className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:[s.jsx(m,{className:"w-4 h-4"}),"Save Photo"]})]})]}):s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex gap-4",children:[s.jsxs("button",{onClick:async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}});U.current&&(U.current.srcObject=e,b(!0))}catch(e){alert("Unable to access camera. Please check permissions.")}},disabled:j,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(a,{className:"w-5 h-5"}),j?"Capturing...":"Start Camera"]}),s.jsxs("button",{onClick:()=>T.current?.click(),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:[s.jsx(n,{className:"w-5 h-5"}),"Upload Photo"]})]}),j&&s.jsxs("div",{className:"relative",children:[s.jsx("video",{ref:U,autoPlay:!0,playsInline:!0,className:"w-full h-64 bg-gray-900 rounded-lg object-cover"}),s.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-4",children:[s.jsx("button",{onClick:()=>{if(U.current&&D.current){const e=U.current,s=D.current,a=s.getContext("2d");a&&(s.width=e.videoWidth,s.height=e.videoHeight,a.drawImage(e,0,0),s.toBlob(e=>{if(e){const s=new File([e],`photo-${Date.now()}.jpg`,{type:"image/jpeg"}),a=URL.createObjectURL(e),l={id:`photo-${Date.now()}`,file:s,preview:a,metadata:{timestamp:(new Date).toISOString(),location:k||void 0,projectId:t,taskId:h,tags:[...E],notes:L}};w(l),v(e=>[...e,l]),M()}},"image/jpeg",.9))}},className:"w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-lg",children:s.jsx(a,{className:"w-8 h-8 text-gray-800"})}),s.jsx("button",{onClick:M,className:"w-12 h-12 bg-red-600 rounded-full flex items-center justify-center shadow-lg",children:s.jsx(i,{className:"w-6 h-6 text-white"})})]})]}),s.jsx("input",{ref:T,type:"file",accept:"image/*",capture:"environment",onChange:e=>{const s=e.target.files?.[0];if(s){const e=URL.createObjectURL(s),a={id:`photo-${Date.now()}`,file:s,preview:e,metadata:{timestamp:(new Date).toISOString(),location:k||void 0,projectId:t,taskId:h,tags:[...E],notes:L}};w(a),v(e=>[...e,a])}},className:"hidden"}),k&&s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:[s.jsx(c,{className:"w-4 h-4 text-green-600"}),s.jsxs("span",{className:"text-sm text-green-800",children:["Location: ",k.latitude.toFixed(4),", ",k.longitude.toFixed(4)]})]}),!y&&s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[s.jsx(o,{className:"w-4 h-4 text-yellow-600"}),s.jsx("span",{className:"text-sm text-yellow-800",children:"You're offline. Photos will be synced when connection is restored."})]})]}),f.length>0&&s.jsxs("div",{className:"mt-6 border-t border-gray-200 pt-4",children:[s.jsxs("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:["Captured Photos (",f.length,")"]}),s.jsx("div",{className:"grid grid-cols-2 gap-3",children:f.map(e=>s.jsxs("div",{className:"relative",children:[s.jsx("img",{src:e.preview,alt:"Captured photo",className:"w-full h-24 object-cover rounded-lg"}),s.jsx("div",{className:"absolute top-1 right-1",children:s.jsxs("span",{className:"px-2 py-1 bg-black bg-opacity-50 text-white text-xs rounded",children:[e.metadata.tags.length," tags"]})})]},e.id))})]})]}),s.jsx("canvas",{ref:D,className:"hidden"})]})})},j=({currentUser:i,projectId:n})=>{const[o,d]=e.useState(null),[m,j]=e.useState([]),[b,f]=e.useState(navigator.onLine);t.useEffect(()=>{const e=()=>f(!0),s=()=>f(!1);return window.addEventListener("online",e),window.addEventListener("offline",s),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s)}},[]);const v=[{id:"photo-capture",name:"Photo Capture",description:"Capture photos with GPS location and metadata",icon:a,color:"bg-blue-50 text-blue-700 border-blue-200",features:["GPS Location","Metadata Tags","Offline Storage","Auto Sync"]},{id:"location-tracking",name:"Location Tracking",description:"Track team locations and site visits",icon:c,color:"bg-green-50 text-green-700 border-green-200",features:["Real-time Tracking","Site Visits","Geofencing","History Log"]},{id:"calendar-sync",name:"Calendar Sync",description:"Sync project deadlines with mobile calendar",icon:x,color:"bg-purple-50 text-purple-700 border-purple-200",features:["Deadline Sync","Meeting Integration","Reminders","Team Scheduling"]}],N=()=>{const e=window.innerWidth;return e<768?"mobile":e<1024?"tablet":"desktop"};return s.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[s.jsx("div",{className:"mb-8",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Mobile Tools"}),s.jsx("p",{className:"text-gray-600",children:"Mobile-optimized tools for construction site management"})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-100 rounded-lg",children:[(()=>{switch(N()){case"mobile":return s.jsx(u,{className:"w-5 h-5"});case"tablet":return s.jsx(g,{className:"w-5 h-5"});default:return s.jsx(h,{className:"w-5 h-5"})}})(),s.jsxs("span",{className:"text-sm font-medium text-gray-700 capitalize",children:[N()," view"]})]}),s.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-100 rounded-lg",children:[b?s.jsx(l,{className:"w-4 h-4 text-green-600"}):s.jsx(r,{className:"w-4 h-4 text-red-600"}),s.jsx("span",{className:"text-sm font-medium text-gray-700",children:b?"Online":"Offline"})]})]})]})}),"photo-capture"===o?s.jsx(p,{projectId:n,onPhotoCapture:e=>{j(s=>[...s,e])},onClose:()=>d(null),className:"mb-6"}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6",children:v.map(e=>{const t=e.icon;return s.jsxs("div",{className:"border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>d(e.id),children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:`p-3 rounded-lg ${e.color}`,children:s.jsx(t,{className:"w-6 h-6"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),s.jsx("p",{className:"text-sm text-gray-600",children:e.description})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Features"}),s.jsx("div",{className:"flex flex-wrap gap-1",children:e.features.map(e=>s.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded",children:e},e))})]}),s.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:s.jsx("button",{className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Open Tool"})})]},e.id)})}),m.length>0&&s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-4",children:"Recent Captures"}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:m.slice(-8).map((e,t)=>s.jsxs("div",{className:"relative",children:[s.jsx("img",{src:e.preview,alt:`Captured photo ${t+1}`,className:"w-full h-24 object-cover rounded-lg"}),s.jsx("div",{className:"absolute top-1 right-1",children:s.jsxs("span",{className:"px-2 py-1 bg-black bg-opacity-50 text-white text-xs rounded",children:[e.metadata.tags.length," tags"]})})]},t))}),s.jsx("div",{className:"mt-4 text-center",children:s.jsxs("span",{className:"text-sm text-blue-700",children:[m.length," photos captured"]})})]}),s.jsxs("div",{className:"mt-8 bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-yellow-900 mb-4",children:"Mobile Optimization Tips"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"For Best Experience"}),s.jsxs("ul",{className:"text-sm text-yellow-800 space-y-1",children:[s.jsx("li",{children:"• Enable location services for GPS features"}),s.jsx("li",{children:"• Allow camera access for photo capture"}),s.jsx("li",{children:"• Use landscape mode for better viewing"}),s.jsx("li",{children:"• Keep app updated for latest features"})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"Offline Mode"}),s.jsxs("ul",{className:"text-sm text-yellow-800 space-y-1",children:[s.jsx("li",{children:"• Photos are stored locally when offline"}),s.jsx("li",{children:"• Data syncs automatically when online"}),s.jsx("li",{children:"• Core features work without internet"}),s.jsx("li",{children:"• Real-time features require connection"})]})]})]})]})]})};export{j as MobileToolsScreen};

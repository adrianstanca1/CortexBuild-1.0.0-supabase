import{r as e,j as t}from"./react-core-FGHlRSau.js";import{F as s,I as a,l as r,Q as l,$ as n}from"./module-screens-Dy02k3Q1.js";import{u as d}from"./index-DOZ8AkwU.js";import"./vendor-BX0gT1qP.js";import"./google-ai-BrP-uSwO.js";import"./developer-tools-B-VjJpHg.js";import"./supabase-DKHGIEFa.js";import"./axios-ei4kQ0Q2.js";import"./icon-pack-tZfEXMDa.js";import"./monaco-Bh77eHRb.js";const i=({project:i,navigateTo:o,goBack:c,currentUser:u})=>{const[m,x]=e.useState([]),[g,h]=e.useState(!0),[b,j]=e.useState(!1),[p,f]=e.useState({status:"all",assignee:"all",dueDateStart:"",dueDateEnd:""}),[D,v]=e.useState("dueDate-asc"),{can:w}=d(u),y=w("create","rfi");e.useEffect(()=>{(async()=>{h(!0);const e=await n(i.id);x(e),h(!1)})()},[i.id]);const N=e.useMemo(()=>{let e=[...m];if("all"!==p.status&&(e=e.filter(e=>e.status===p.status)),"all"!==p.assignee&&(e=e.filter(e=>e.assignee===p.assignee)),p.dueDateStart){const t=new Date(p.dueDateStart);t.setHours(0,0,0,0),e=e.filter(e=>new Date(e.dueDate)>=t)}if(p.dueDateEnd){const t=new Date(p.dueDateEnd);t.setHours(23,59,59,999),e=e.filter(e=>new Date(e.dueDate)<=t)}const t=D;return e.sort((e,s)=>{if("dueDate-desc"===t)return new Date(s.dueDate).getTime()-new Date(e.dueDate).getTime();if("status"===t){const t={Open:1,Draft:2,Closed:3};return(t[e.status]??99)-(t[s.status]??99)}const a="Closed"===e.status,r="Closed"===s.status;if("Closed"!==p.status){if(a&&!r)return 1;if(!a&&r)return-1}return new Date(e.dueDate).getTime()-new Date(s.dueDate).getTime()}),e},[m,p,D]),S=e=>{const{name:t,value:s}=e.target;f(e=>({...e,[t]:s}))};return t.jsxs("div",{className:"flex flex-col h-full max-w-4xl mx-auto",children:[t.jsxs("header",{className:"bg-white p-4 flex justify-between items-center border-b mb-8",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("button",{onClick:c,className:"mr-4 p-2 rounded-full hover:bg-gray-100",children:t.jsx(s,{className:"w-6 h-6 text-gray-600"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"RFIs"}),t.jsx("p",{className:"text-sm text-gray-500",children:i.name})]})]}),y&&t.jsx("button",{onClick:()=>o("new-rfi"),className:"bg-blue-600 text-white p-2.5 rounded-full shadow hover:bg-blue-700",children:t.jsx(a,{className:"w-6 h-6"})})]}),t.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("button",{onClick:()=>j(e=>!e),className:"flex items-center gap-2 font-bold text-gray-700",children:["Filters",t.jsx(r,{className:"w-5 h-5 transition-transform "+(b?"rotate-180":"")})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("label",{htmlFor:"sortBy",className:"text-sm font-medium text-gray-600",children:"Sort by:"}),t.jsxs("select",{id:"sortBy",name:"sortBy",value:D,onChange:e=>v(e.target.value),className:"p-2 border border-gray-300 rounded-md text-sm bg-white",children:[t.jsx("option",{value:"dueDate-asc",children:"Due Date (Soonest)"}),t.jsx("option",{value:"dueDate-desc",children:"Due Date (Latest)"}),t.jsx("option",{value:"status",children:"Status"})]})]})]}),b&&t.jsxs("div",{className:"mt-4 pt-4 border-t",children:[t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 items-end",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),t.jsxs("select",{id:"status",name:"status",value:p.status,onChange:S,className:"mt-1 block w-full p-2 border border-gray-300 rounded-md bg-white",children:[t.jsx("option",{value:"all",children:"All Statuses"}),t.jsx("option",{value:"Open",children:"Open"}),t.jsx("option",{value:"Closed",children:"Closed"}),t.jsx("option",{value:"Draft",children:"Draft"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"assignee",className:"block text-sm font-medium text-gray-700",children:"Assignee"}),t.jsxs("select",{id:"assignee",name:"assignee",value:p.assignee,onChange:S,className:"mt-1 block w-full p-2 border border-gray-300 rounded-md bg-white",children:[t.jsx("option",{value:"all",children:"All Assignees"}),["Architect Team","Structural Engineer","MEP Consultant","General Contractor"].map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{className:"lg:col-span-2 grid grid-cols-2 gap-2",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"dueDateStart",className:"block text-sm font-medium text-gray-700",children:"Due From"}),t.jsx("input",{type:"date",id:"dueDateStart",name:"dueDateStart",value:p.dueDateStart,onChange:S,className:"mt-1 block w-full p-2 border border-gray-300 rounded-md bg-white"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"dueDateEnd",className:"block text-sm font-medium text-gray-700",children:"Due To"}),t.jsx("input",{type:"date",id:"dueDateEnd",name:"dueDateEnd",value:p.dueDateEnd,onChange:S,className:"mt-1 block w-full p-2 border border-gray-300 rounded-md bg-white"})]})]})]}),t.jsx("div",{className:"mt-4 text-right",children:t.jsx("button",{onClick:()=>{f({status:"all",assignee:"all",dueDateStart:"",dueDateEnd:""}),v("dueDate-asc")},className:"px-4 py-2 bg-gray-200 text-gray-700 font-semibold rounded-md hover:bg-gray-300 text-sm",children:"Reset Filters"})})]})]}),t.jsx("main",{className:"flex-grow bg-white rounded-lg shadow-md border border-gray-100 overflow-hidden",children:g?t.jsx("p",{className:"text-center text-gray-500 p-8",children:"Loading RFIs..."}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"p-2 bg-gray-50 border-b text-sm text-gray-600 font-semibold",children:["Showing ",N.length," of ",m.length," RFIs."]}),t.jsx("ul",{className:"divide-y divide-gray-200",children:0===N.length?t.jsx("p",{className:"p-4 text-sm text-center text-gray-500",children:"No RFIs match the current filters."}):N.map(e=>{const s=(e=>{if("Open"!==e.status)return!1;const t=new Date;return t.setHours(0,0,0,0),new Date(e.dueDate)<t})(e),a=s?"bg-red-600 text-white":(e=>{switch(e){case"Open":return"bg-blue-600 text-white";case"Closed":return"bg-green-600 text-white";case"Draft":return"bg-slate-500 text-white";default:return"bg-gray-500 text-white"}})(e.status);return t.jsxs("li",{onClick:()=>o("rfi-detail",{rfiId:e.id}),className:"p-4 flex items-center justify-between hover:bg-gray-50 cursor-pointer border-l-4 "+(s?"bg-red-100 border-red-500":"border-transparent"),children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(l,{className:"w-8 h-8 "+(s?"text-red-500":"text-blue-500")}),t.jsxs("div",{children:[t.jsx("p",{className:"font-semibold text-gray-800",children:e.subject}),t.jsxs("p",{className:"text-sm text-gray-500",children:["To: ",e.assignee]})]})]}),t.jsxs("div",{className:"text-right flex flex-col items-end gap-1",children:[t.jsx("span",{className:`px-3 py-1 text-sm font-semibold rounded-full ${a}`,children:e.status}),t.jsxs("p",{className:"text-xs mt-1 "+(s?"text-red-600 font-bold":"text-gray-500"),children:["Due: ",new Date(e.dueDate).toLocaleDateString()]})]})]},e.id)})})]})})]})};export{i as default};
